<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 1: Introduction to Mechanisms & Levers</title>
    <!-- Web research integration: Using a clean, modern font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* CSS Variables for Theming (Light/Dark Mode) */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --bg-main: #f4f7f6;
            --bg-card: #ffffff;
            --bg-light: #ecf0f1;
            --text-dark: #2c3e50;
            --text-light: #5a6a7a;
            --border-color: #dfe4ea;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --shadow-color-hover: rgba(0, 0, 0, 0.15);
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --gradient-success: linear-gradient(135deg, var(--success) 0%, #2ecc71 100%);
            --gradient-accent: linear-gradient(135deg, var(--accent) 0%, #e67e22 100%);
        }

        .dark-mode {
            --primary: #ecf0f1;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --bg-main: #1a2634;
            --bg-card: #2c3e50;
            --bg-light: #233140;
            --text-dark: #ffffff;
            --text-light: #bdc3c7;
            --border-color: #3e5062;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --shadow-color-hover: rgba(0, 0, 0, 0.4);
        }

        /* General Body Styling */
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.7;
            color: var(--text-light);
            background: var(--bg-main);
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-card);
            min-height: 100vh;
            box-shadow: 0 0 40px var(--shadow-color);
            transition: background 0.3s ease;
        }

        /* 1. Header & Navigation */
        header {
            background: var(--gradient-primary);
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .theme-toggle-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            transition: all 0.3s ease;
        }

        .theme-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }

        nav {
            background: var(--bg-light);
            padding: 1rem;
            position: sticky;
            top: 85px; /* Adjusted based on header height */
            z-index: 99;
            border-bottom: 3px solid var(--secondary);
            overflow-x: auto;
            white-space: nowrap;
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        nav a {
            text-decoration: none;
            color: var(--text-dark);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: 600;
        }

        nav a:hover, nav a.active {
            background: var(--secondary);
            color: white;
            transform: translateY(-2px);
        }

        /* Progress Bar */
        .progress-container {
            background: var(--bg-light);
            padding: 0.5rem 1rem;
            position: sticky;
            top: 152px; /* Adjusted based on header+nav height */
            z-index: 98;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: var(--border-color);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px var(--shadow-color);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-success);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Section Styling */
        section {
            padding: 3rem 2rem;
            border-bottom: 1px solid var(--border-color);
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        section:nth-child(even) {
            background: var(--bg-light);
        }

        h2 {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 1.5rem;
            border-left: 5px solid var(--secondary);
            padding-left: 1rem;
        }

        h3 {
            color: var(--secondary);
            margin: 1.5rem 0 1rem;
        }

        p, li {
            margin-bottom: 1rem;
            color: var(--text-light);
        }
        
        ul, ol {
            padding-left: 1.5rem;
        }

        /* Card System */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px var(--shadow-color);
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--shadow-color-hover);
        }

        .card h4 {
            color: var(--secondary);
            margin-bottom: 1rem;
        }
        
        .card code {
            background: var(--bg-light);
            color: var(--accent);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 1.1rem;
        }

        /* Opening Activity Grid System (UPDATED FOR IMAGE DIMENSIONS) */
        .opening-grid {
            display: grid;
            /* Creates a responsive grid */
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .opening-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.8rem; /* Reduced padding to give more space to image */
            text-align: center;
            transition: transform 0.2s;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .opening-item:hover {
            transform: scale(1.03);
            border-color: var(--secondary);
        }

        /* Key fix for image dimensions */
        .image-placeholder-box {
            width: 100%;
            aspect-ratio: 4 / 3; /* Forces a consistent rectangular shape */
            background-color: var(--bg-light);
            border-radius: 6px;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem; /* Larger emoji */
            color: var(--text-light);
            border: 1px solid var(--border-color);
            overflow: hidden; /* Clips any image overflow */
        }

        /* Forces images to fill the box perfectly */
        .image-placeholder-box img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Crops image to fill container without distortion */
            display: block;
        }

        .opening-item span {
            font-weight: 600;
            color: var(--primary);
            display: block;
            margin-top: 0.5rem;
        }


        /* Expandable Section */
        .expandable {
            margin: 1rem 0;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg-card);
        }

        .expandable-header {
            background: var(--bg-light);
            color: var(--text-dark);
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: background 0.3s;
            border-bottom: 1px solid var(--border-color);
        }

        .expandable-header:last-child {
            border-bottom: none;
        }

        .expandable-header:hover {
            background: var(--secondary);
            color: white;
        }
        
        .expandable-header span:last-child {
            transition: transform 0.3s ease;
        }

        .expandable-header.active span:last-child {
            transform: rotate(180deg);
        }

        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.4s ease;
        }

        .expandable-content.active {
            max-height: 2000px; /* Large value */
            padding: 1.5rem;
        }

        /* Quiz & Calculator Styling */
        .quiz-container {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            box-shadow: 0 4px 15px var(--shadow-color);
        }
        
        .quiz-question {
            margin-bottom: 1.5rem;
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .quiz-question p {
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Buttons */
        .btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0.5rem;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px var(--shadow-color-hover);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #239b56;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px var(--shadow-color-hover);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-disabled {
            background: var(--text-light) !important;
            cursor: not-allowed;
            opacity: 0.7;
            pointer-events: none;
        }

        /* Feedback Messages */
        .feedback {
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            font-weight: 600;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .feedback.success {
            background: rgba(39, 174, 96, 0.1);
            border-left: 4px solid var(--success);
            color: var(--success);
        }

        .feedback.error {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid var(--accent);
            color: var(--accent);
        }
        
        /* Utility */
        .text-center {
            text-align: center;
        }
        
        .hidden {
            display: none;
        }
        
        /* Inputs */
        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-dark);
            border-radius: 5px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s;
            margin-top: 0.5rem;
        }

        input:disabled, textarea:disabled {
            background-color: var(--bg-light);
            color: var(--text-light);
            cursor: not-allowed;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input[type="text"]:focus, input[type="number"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }
        
        label {
            font-weight: 600;
            color: var(--text-dark);
            display: block;
            margin-top: 1rem;
        }
        
        /* Specificity for radio labels */
        input[type="radio"] + label {
            width: auto;
            display: inline;
            padding: 0.5rem;
            cursor: pointer;
            margin-top: 0;
        }

        /* Illustrations */
        .svg-container {
            text-align: center;
            margin: 2rem 0;
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 10px;
        }

        svg, .img-placeholder {
            max-width: 100%;
            height: auto;
            stroke: var(--text-dark);
            fill: var(--text-dark);
        }
        
        .img-placeholder {
            width: 100%;
            border-radius: 8px;
        }

        /* Resource Links Styling */
        .resource-link {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 8px;
            margin-bottom: 1rem;
            text-decoration: none;
            color: var(--text-dark);
            transition: transform 0.2s, background 0.2s;
            border: 1px solid var(--border-color);
        }

        .resource-link:hover {
            transform: translateX(5px);
            background: white;
            border-color: var(--secondary);
        }

        .resource-icon {
            font-size: 2rem;
            margin-right: 1rem;
        }

        .resource-info strong {
            color: var(--secondary);
            display: block;
        }

        .resource-info small {
            color: var(--text-light);
        }
        
        /* Vocabulary */
        .vocab-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .vocab-item {
            background: var(--bg-card);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .vocab-term {
            font-weight: bold;
            color: var(--secondary);
            font-size: 1.1rem;
        }
        
        .vocab-def {
            margin-top: 0.5rem;
            color: var(--text-light);
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                text-align: left;
                padding: 1rem;
            }
            header h1 {
                font-size: 1.5rem;
            }
            header p {
                font-size: 0.9rem;
            }
            .theme-toggle-btn {
                top: 1rem;
                right: 1rem;
                width: 35px;
                height: 35px;
                font-size: 1.2rem;
            }
            nav {
                top: 80px; /* Adjusted for responsive header height */
            }
            .progress-container {
                top: 147px; /* Adjusted for responsive header+nav height */
            }
            section {
                padding: 2rem 1rem;
            }
            .card-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 1. Header and Navigation -->
        <header>
            <button class="theme-toggle-btn" id="themeToggle" aria-label="Toggle light/dark mode">üåô</button>
            <h1>üîß Week 1: Introduction to Mechanisms & Levers</h1>
            <p>IGCSE Design & Technology (0445) | Grade 10 | 90 minutes</p>
        </header>

        <!-- NAV -->
        <nav id="main-nav">
            <ul>
                <li><a href="#opening" class="nav-link">Opening</a></li>
                <li><a href="#objectives" class="nav-link">Objectives</a></li>
                <li><a href="#exploration" class="nav-link">Exploration</a></li>
                <li><a href="#practice" class="nav-link">Guided Practice</a></li>
                <li><a href="#ccq" class="nav-link">Concept Check</a></li>
                <li><a href="#wrapup" class="nav-link">Wrap-Up</a></li>
                <li><a href="#vocabulary" class="nav-link">Vocabulary</a></li>
            </ul>
        </nav>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%;">0%</div>
            </div>
        </div>

        <!-- 2. Opening Activity (FIXED IMAGES) -->
        <section id="opening">
            <h2>üéØ Opening Activity: Lever Hunt & Force Challenge</h2>
            <p><strong>Time: 10 minutes</strong></p>
            
            <div class="card" style="margin-top: 2rem;">
                <h4>Part A: Lever Hunt (In Pairs)</h4>
                <p>Look at these common objects below. Discuss these three questions with your partner:</p>
                <ol>
                    <li>Which of these help you do work more easily?</li>
                    <li>Where do you push or pull on each one (the Effort)?</li>
                    <li>Where does the object seem to rotate or pivot (the Fulcrum)?</li>
                </ol>
                
                <!-- GRID WITH FIXED ASPECT RATIOS -->
                <div class="opening-grid">
                    <div class="opening-item">
                        <div class="image-placeholder-box">
                            <!-- Emojis as fallback or primary if no image URL -->
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJnsNWH45hKSaVeuIncen-Yz-XRv_CttWu0A&s" alt="Scissors">
                        </div>
                        <span>Scissors</span>
                    </div>
                    <div class="opening-item">
                        <div class="image-placeholder-box">
                            <img src="https://hips.hearstapps.com/hmg-prod/images/wheelbarrow-use-0066-preview-6426e5e567a59.jpg?crop=0.8890666666666666xw:1xh;center,top&resize=1200:*" alt="Wheelbarrow">
                        </div>
                        <span>Wheelbarrow</span>
                    </div>
                    <div class="opening-item">
                        <div class="image-placeholder-box">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSg44uTi6wHSJOO7cLU3m2Qo8MF-j9-2c1lMw&s" alt="Tweezers">
                        </div>
                        <span>Tweezers</span>
                    </div>
                    <div class="opening-item">
                        <div class="image-placeholder-box">
                            <img src="https://www.rockler.com/media/catalog/product/4/4/44185-01-1000.jpg" alt="Bottle Opener">
                        </div>
                        <span>Bottle Opener</span>
                    </div>
                    <div class="opening-item">
                        <div class="image-placeholder-box">
                            <img src="https://hardwickandsons.com/cdn/shop/files/DSC05481.jpg?v=1695766861&width=1445" alt="Crowbar">
                        </div>
                        <span>Crowbar</span>
                    </div>
                    <div class="opening-item">
                        <div class="image-placeholder-box">
                            <img src="https://m.media-amazon.com/images/I/91QiqjOLO0L._AC_UF894,1000_QL80_.jpg" alt="Seesaw">
                        </div>
                        <span>Seesaw</span>
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 1rem; text-align: center;">*Tip: Imagine using each item to help find the pivot point.*</p>
            </div>
            
            <div class="card" style="margin-top: 2rem;">
                <h4>Part B: Force Challenge (Demonstration)</h4>
                <p>Think about a bottle opener:</p>
                <ul>
                    <li>Observe the opener being placed on a bottle. Identify the hand position (Effort), the cap (Load), and the pivot point (Fulcrum).</li>
                    <li>Next, observe what happens when the hand moves *closer* to the cap.</li>
                </ul>
                <p><strong>Key Question:</strong> Which way was easier? Why?</p>
            </div>

            <div class="card" style="margin-top: 2rem;">
                <h4>Connection</h4>
                <p>All these tools rotate around a point to help us. Today we'll learn there are THREE different ways to arrange these parts - these are called 'lever classes.'</p>
                <div class="svg-container">
                    <img src="https://cdn.britannica.com/84/241884-050-F43F390E/Trebuchet-catapult-medieval-siege-engine-Chateau-Castelnaud-Castle-Perigord-France.jpg" alt="Medieval Trebuchet" class="img-placeholder">
                </div>
                <label for="openingThoughts">Your initial thoughts: How did ancient armies use levers like this to launch projectiles?</label>
                <textarea id="openingThoughts" placeholder="Type your thoughts here..."></textarea>
            </div>
        </section>

        <!-- 3. Learning Objectives Section -->
        <section id="objectives">
            <h2>üéì Learning Objectives</h2>
            <p>Here's our plan for this week (Cambridge 4.3.1).</p>
            
            <h3>By the end of this class, I will be able to‚Ä¶</h3>
            
            <div class="expandable">
                <div class="expandable-header active"> <!-- Start open -->
                    <span>üß† Cognitive Objectives (What I'll know)</span>
                    <span>‚ñº</span>
                </div>
                <div class="expandable-content active"> <!-- Start open -->
                    <ul>
                        <li>‚úÖ <strong>Identify</strong> the three classes of levers.</li>
                        <li>‚úÖ <strong>Understand</strong> and label the Fulcrum, Load, and Effort.</li>
                        <li>‚úÖ <strong>Calculate</strong> Mechanical Advantage (MA) for levers.</li>
                        <li>‚úÖ <strong>Introduce</strong> and define Torque as a rotational force.</li>
                        <li>‚úÖ <strong>Recognize</strong> real-world lever applications (including catapults).</li>
                    </ul>
                </div>
                
                <div class="expandable-header"> 
                    <span>‚ù§Ô∏è SEL Goals (Social & Emotional Learning)</span>
                    <span>‚ñº</span>
                </div>
                <div class="expandable-content">
                    <ul>
                        <li>ü§ù <strong>Social Awareness:</strong> I will work collaboratively with my partner during the Lever Hunt, listening to their ideas respectfully.</li>
                        <li>üß† <strong>Self-Management:</strong> I will stay focused during the Virtual Lab calculations, even if the math gets tricky.</li>
                        <li>ü§î <strong>Responsible Decision-Making:</strong> I will reflect on how simple tools (like levers) have impacted history and society.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 4. Concept Exploration -->
        <section id="exploration">
            <h2>üîç Concept Exploration: Levers, MA & Torque</h2>
            <p>Reference: Student Book pages 265-266</p>

            <h3>‚öôÔ∏è What is a Lever?</h3>
            <p>A lever is a <strong>rigid bar</strong> that pivots around a fixed point called a <strong>Fulcrum</strong>. Levers help us lift heavy loads (the <strong>Load</strong>) with less force (the <strong>Effort</strong>).</p>

            <div class="card-grid">
                <div class="card">
                    <h4>Class 1: Fulcrum in the Middle</h4>
                    <div class="svg-container">
                        <svg width="250" height="120" viewBox="0 0 250 120">
                            <title>Class 1 Lever Diagram</title>
                            <line x1="20" y1="60" x2="230" y2="60" stroke="var(--primary)" stroke-width="6"/>
                            <polygon points="125,60 105,85 145,85" fill="var(--accent)"/>
                            <circle cx="20" cy="60" r="12" fill="var(--secondary)"/>
                            <text x="10" y="105" font-size="12" fill="var(--secondary)">Effort</text>
                            <circle cx="230" cy="60" r="12" fill="var(--warning)"/>
                            <text x="220" y="105" font-size="12" fill="var(--warning)">Load</text>
                            <text x="105" y="105" font-size="12" fill="var(--accent)">Fulcrum</text>
                        </svg>
                    </div>
                    <p>The Fulcrum is between the Effort and the Load.</p>
                    <p><strong>Examples:</strong> Seesaw, scissors, crowbar, catapult arm.</p>
                </div>

                <div class="card">
                    <h4>Class 2: Load in the Middle</h4>
                    <div class="svg-container">
                        <svg width="250" height="120" viewBox="0 0 250 120">
                            <title>Class 2 Lever Diagram</title>
                            <line x1="20" y1="60" x2="230" y2="40" stroke="var(--primary)" stroke-width="6"/>
                            <polygon points="20,60 10,85 30,85" fill="var(--accent)"/>
                            <circle cx="230" cy="40" r="12" fill="var(--secondary)"/>
                            <text x="220" y="25" font-size="12" fill="var(--secondary)">Effort</text>
                            <circle cx="125" cy="50" r="12" fill="var(--warning)"/>
                            <text x="110" y="30" font-size="12" fill="var(--warning)">Load</text>
                            <text x="5" y="105" font-size="12" fill="var(--accent)">Fulcrum</text>
                        </svg>
                    </div>
                    <p>The Load is between the Fulcrum and the Effort.</p>
                    <p><strong>Examples:</strong> Wheelbarrow, bottle opener, nutcracker.</p>
                    <p><strong>Fact:</strong> Always has Mechanical Advantage (MA > 1).</p>
                </div>

                <div class="card">
                    <h4>Class 3: Effort in the Middle</h4>
                    <div class="svg-container">
                        <svg width="250" height="120" viewBox="0 0 250 120">
                            <title>Class 3 Lever Diagram</title>
                            <line x1="20" y1="60" x2="230" y2="40" stroke="var(--primary)" stroke-width="6"/>
                            <polygon points="20,60 10,85 30,85" fill="var(--accent)"/>
                            <circle cx="125" cy="50" r="12" fill="var(--secondary)"/>
                            <text x="110" y="30" font-size="12" fill="var(--secondary)">Effort</text>
                            <circle cx="230" cy="40" r="12" fill="var(--warning)"/>
                            <text x="220" y="25" font-size="12" fill="var(--warning)">Load</text>
                            <text x="5" y="105" font-size="12" fill="var(--accent)">Fulcrum</text>
                        </svg>
                    </div>
                    <p>The Effort is between the Fulcrum and the Load.</p>
                    <p><strong>Examples:</strong> Tweezers, fishing rod, human arm.</p>
                    <p><strong>Fact:</strong> Always has MA < 1 (a disadvantage!) but gives speed/distance.</p>
                </div>
            </div>

            <!-- Mechanical Advantage (MA) Section -->
            <h3>üìà Mechanical Advantage (MA)</h3>
            <p><strong>Definition:</strong> The factor by which a mechanism multiplies the force you apply. A high MA means it's easier to move the load.</p>
            <div class="card">
                <h4>MA Formula & Representation</h4>
                <p><code>a = Distance from Fulcrum to Effort (Effort Arm)</code></p>
                <p style="text-align: center;">--- divided by ---</p>
                <p><code>b = Distance from Fulcrum to Load (Load Arm)</code></p>
                <p style="font-size: 1.2rem; text-align: center; margin: 1rem 0;"><code>MA = a / b</code></p>
                
                <!-- SVG Representation of the user's specific request -->
                <div class="svg-container" style="border: 2px solid var(--secondary); background: white;">
                   <svg width="400" height="180" viewBox="0 0 400 180">
                        <title>Lever Diagram with Dimensions</title>
                        <!-- Ground Line -->
                        <line x1="20" y1="160" x2="380" y2="160" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5" />
                        
                        <!-- Lever Bar -->
                        <line x1="50" y1="100" x2="350" y2="100" stroke="var(--primary)" stroke-width="8" stroke-linecap="round" />
                        
                        <!-- Fulcrum (Positioned to show 1.5 vs 0.5 ratio roughly) -->
                        <polygon points="275,100 260,130 290,130" fill="var(--accent)" />
                        <text x="275" y="150" font-size="14" text-anchor="middle" fill="var(--accent)" font-weight="bold">Fulcrum</text>

                        <!-- Load (Right Side) -->
                        <rect x="330" y="60" width="40" height="40" fill="var(--warning)" stroke="#2c3e50" stroke-width="2"/>
                        <text x="350" y="50" font-size="14" text-anchor="middle" fill="var(--warning)" font-weight="bold">Load</text>
                        
                        <!-- Effort (Left Side) -->
                        <line x1="50" y1="30" x2="50" y2="90" stroke="var(--secondary)" stroke-width="3" />
                        <polygon points="50,100 45,90 55,90" fill="var(--secondary)" /> 
                        <text x="50" y="25" font-size="14" text-anchor="middle" fill="var(--secondary)" font-weight="bold">Effort</text>

                        <!-- Dimension Lines & Text -->
                        <!-- Effort Arm (a) = 1.5m -->
                        <line x1="50" y1="115" x2="275" y2="115" stroke="var(--text-light)" stroke-width="1" />
                        <line x1="50" y1="110" x2="50" y2="120" stroke="var(--text-light)" stroke-width="1" />
                        <line x1="275" y1="110" x2="275" y2="120" stroke="var(--text-light)" stroke-width="1" />
                        <text x="160" y="135" font-size="14" text-anchor="middle" fill="var(--text-dark)">a = 1.5m</text>

                        <!-- Load Arm (b) = 0.5m -->
                        <line x1="275" y1="115" x2="350" y2="115" stroke="var(--text-light)" stroke-width="1" />
                        <line x1="350" y1="110" x2="350" y2="120" stroke="var(--text-light)" stroke-width="1" />
                        <text x="315" y="135" font-size="14" text-anchor="middle" fill="var(--text-dark)">b = 0.5m</text>
                   </svg>
                </div>

                <p><strong>Example:</strong> If the Effort Arm (a) is <strong>1.5m</strong> and the Load Arm (b) is <strong>0.5m</strong>:</p>
                <p><code>MA = 1.5m / 0.5m = 3</code></p>
                <p>This means you can lift <strong>3 times the load</strong> with the same effort!</p>
            </div>

            <!-- Torque Section with Video Resources -->
            <h3 style="margin-top: 2rem;">üåÄ Introduction to Torque (œÑ)</h3>
            <p><strong>Definition:</strong> Torque is the <strong>rotational force</strong> that causes an object to rotate around an axis (like a fulcrum).</p>
            <div class="card-grid">
                <div class="card">
                    <h4>Torque Formula</h4>
                    <p><code>Torque (œÑ) = Force √ó Perpendicular Distance from axis</code></p>
                    <p><strong>Units:</strong> Newton-meters (Nm)</p>
                    <p><strong>Example (Pushing a door):</strong></p>
                    <ul>
                        <li>You push with <strong>10N</strong> of force.</li>
                        <li>You push at <strong>0.8m</strong> from the hinge.</li>
                        <li>Torque = 10N √ó 0.8m = <strong>8 Nm</strong></li>
                    </ul>
                    <p>Pushing farther from the hinge (greater distance) creates more torque, making it easier to open!</p>
                </div>
                <div class="card">
                    <h4>Torque in Levers (Principle of Moments)</h4>
                    <p>For a lever to be balanced, the torques must be equal:</p>
                    <p style="text-align: center; font-weight: 600;"><code>Clockwise Torque = Counterclockwise Torque</code></p>
                    <p>This gives us a new formula:</p>
                    <p><code>(Force_effort √ó Distance_effort) = (Force_load √ó Distance_load)</code></p>
                    <p>You can use this to find out how much effort force you need to lift a specific load!</p>
                </div>
            </div>
            
            <!-- VIDEO RESOURCES -->
            <div class="card" style="border-left: 5px solid var(--warning); margin-top: 2rem;">
                <h4>üìö Missed Class? Further Learning & Videos</h4>
                <p>If you missed the lesson or want to review the concepts of Torque and Levers, check out these resources:</p>
                
                <a href="https://www.youtube.com/watch?v=jg4e8W44_E4" target="_blank" class="resource-link">
                    <div class="resource-icon">üì∫</div>
                    <div class="resource-info">
                        <strong>Torque, Levers & Simple Machines</strong>
                        <small>The Organic Chemistry Tutor - excellent breakdown of calculations.</small>
                    </div>
                </a>

                <a href="https://www.youtube.com/watch?v=bSU0MWnKoo8" target="_blank" class="resource-link">
                    <div class="resource-icon">üí™</div>
                    <div class="resource-info">
                        <strong>Torque Applied to Levers</strong>
                        <small>Dr. Borst - How torque works specifically in lever systems.</small>
                    </div>
                </a>
                
                <a href="https://www.youtube.com/watch?v=lmROfslzczE" target="_blank" class="resource-link">
                    <div class="resource-icon">‚öôÔ∏è</div>
                    <div class="resource-info">
                        <strong>Lever: Torque and Fulcrum Explained</strong>
                        <small>Visual explanation of force multiplication and torque.</small>
                    </div>
                </a>
            </div>
            
            <div class="card" style="background: var(--gradient-accent); color: white; margin-top: 2rem;">
                <h4 style="color: white;">üî• Catapult Connection</h4>
                <p style="color: white;">A catapult's throwing arm is a <strong>Class 1 Lever</strong>. The goal is to create a <strong>massive torque</strong> to launch the projectile (Load).</p>
                <p style="color: white;">Engineers did this by applying a huge Effort (like a massive counterweight) with a short effort arm, which pivots and swings the long load arm, flinging the projectile with incredible speed!</p>
            </div>
        </section>

        <!-- 5. Guided Practice -->
        <section id="practice">
            <h2>üõ†Ô∏è Guided Practice: Virtual Lab (Experiment 1)</h2>
            <p><strong>Time: 30 minutes</strong></p>
            
            <div class="quiz-container">
                <h4>Part A: Class 1 Lever (Virtual)</h4>
                <p>Let's use a 30cm ruler with a pencil as a fulcrum. A <strong>100g Load</strong> is placed at the <strong>5cm mark</strong>.</p>
                
                <h5 style="margin-top: 1.5rem; color: var(--text-dark);">Setup 1: Balanced Lever</h5>
                <p>Place the Fulcrum (pencil) at the <strong>15cm mark</strong>. Apply Effort at the <strong>25cm mark</strong>.</p>
                
                <label for="setup1-load-arm">Load Arm (Fulcrum at 15cm to Load at 5cm):</label>
                <input type="number" id="setup1-load-arm" placeholder="Enter distance in cm">
                
                <label for="setup1-effort-arm">Effort Arm (Fulcrum at 15cm to Effort at 25cm):</label>
                <input type="number" id="setup1-effort-arm" placeholder="Enter distance in cm">
                
                <button class="btn btn-primary" id="calcSetup1">Calculate Setup 1</button>
                <div class="feedback" id="setup1-feedback"></div>

                <hr style="margin: 2rem 0; border: 1px solid var(--border-color);">

                <h5 style="color: var(--text-dark);">Setup 2: Gaining Advantage</h5>
                <p>Now, move the Fulcrum (pencil) to the <strong>10cm mark</strong>. The 100g Load is still at <strong>5cm</strong>. Apply Effort at the <strong>25cm mark</strong>.</p>
                
                <label for="setup2-load-arm">Load Arm (Fulcrum at 10cm to Load at 5cm):</label>
                <input type="number" id="setup2-load-arm" placeholder="Enter distance in cm">
                
                <label for="setup2-effort-arm">Effort Arm (Fulcrum at 10cm to Effort at 25cm):</label>
                <input type="number" id="setup2-effort-arm" placeholder="Enter distance in cm">
                
                <button class="btn btn-primary" id="calcSetup2">Calculate Setup 2</button>
                <div class="feedback" id="setup2-feedback"></div>
                
                <hr style="margin: 2rem 0; border: 1px solid var(--border-color);">
                
                <h4>Part B: Class 2 Lever (Virtual)</h4>
                <p>Let's model a wheelbarrow. The wheel (Fulcrum) is at <strong>0cm</strong>. The Load is at <strong>50cm</strong>. You lift the handles (Effort) at <strong>150cm</strong>.</p>
                
                <label for="setup3-load-arm">Load Arm (Fulcrum at 0cm to Load at 50cm):</label>
                <input type="number" id="setup3-load-arm" placeholder="Enter distance in cm">
                
                <label for="setup3-effort-arm">Effort Arm (Fulcrum at 0cm to Effort at 150cm):</label>
                <input type="number" id="setup3-effort-arm" placeholder="Enter distance in cm">
                
                <button class="btn btn-primary" id="calcSetup3">Calculate Setup 3 (MA)</button>
                <div class="feedback" id="setup3-feedback"></div>
            </div>
        </section>
        
        <!-- 6. Concept Checking -->
        <section id="ccq">
            <h2>üß† Concept Checking Questions</h2>
            <p>Let's check your understanding of MA and Torque.</p>

            <div class="quiz-container">
                <div class="quiz-question">
                    <p>1. If you want the <strong>maximum</strong> Mechanical Advantage from a lever, where should you place the fulcrum?</p>
                    <textarea id="ccq1-answer" rows="2" placeholder="Type your answer here... (e.g., 'Close to the...' or 'Far from the...')"></textarea>
                </div>
                <div class="quiz-question">
                    <p>2. In your own words, why does a wheelbarrow (Class 2) make it easier to lift heavy things? (Hint: Think about the arm lengths)</p>
                    <textarea id="ccq2-answer" rows="2" placeholder="Type your answer here..."></textarea>
                </div>
                <div class="quiz-question">
                    <p>3. Calculate the MA if the Effort Arm is <strong>2m</strong> and the Load Arm is <strong>0.4m</strong>.</p>
                    <input type="number" id="ccq3-answer" placeholder="Enter MA">
                    <button class="btn btn-primary" id="check-ccq3" style="margin-top: 1rem;">Check Answer</button>
                    <div class="feedback" id="ccq3-feedback"></div>
                </div>
                <div class="quiz-question">
                    <p>4. If you push with <strong>50N</strong> of force at <strong>2m</strong> from the fulcrum, what Torque do you generate?</p>
                    <input type="number" id="ccq4-answer" placeholder="Enter Torque in Nm">
                    <button class="btn btn-primary" id="check-ccq4" style="margin-top: 1rem;">Check Answer</button>
                    <div class="feedback" id="ccq4-feedback"></div>
                </div>
                <div class="quiz-question">
                    <p>5. For a catapult, do you want the projectile (Load) close to or far from the fulcrum? Why?</p>
                    <textarea id="ccq5-answer" rows="2" placeholder="Type your answer here..."></textarea>
                </div>
            </div>
        </section>

        <!-- 7. Wrap-Up -->
        <section id="wrapup">
            <h2>üèÅ Wrap-Up & Exit Ticket</h2>
            <p><strong>Time: 15 minutes</strong></p>

            <div class="quiz-container">
                <h4>Skills Activity (Page 268)</h4>
                <p>A lever has an Effort Arm (a) of <strong>1.5m</strong> and a Load Arm (b) of <strong>0.5m</strong>.</p>
                <div class="quiz-question">
                    <p>(i) What is the Mechanical Advantage (MA)?</p>
                    <input type="number" id="skill-ma" placeholder="Calculate MA">
                </div>
                <div class="quiz-question">
                    <p>(ii) What Effort is needed to raise a <strong>300N</strong> Load? (Hint: Effort = Load / MA)</p>
                    <input type="number" id="skill-effort1" placeholder="Calculate Effort in N">
                </div>
                <div class="quiz-question">
                    <p>(iii) What Effort is needed to raise a <strong>480N</strong> Load?</p>
                    <input type="number" id="skill-effort2" placeholder="Calculate Effort in N">
                </div>
                <button class="btn btn-primary" id="check-skills">Check Skills Activity</button>
                <div class="feedback" id="skills-feedback"></div>
            </div>
            
            <div class="quiz-container" style="margin-top: 2rem; background: var(--bg-light);">
                <h4>Exit Ticket</h4>
                <p>Please complete these questions before you leave. Once you save, you cannot change your answers.</p>
                
                <div class="quiz-question">
                    <p>1. Describe a sketch of a <strong>Class 1</strong> lever. Where are the Fulcrum, Load, and Effort?</p>
                    <textarea id="exit-sketch" rows="2" placeholder="e.g., The fulcrum is in the middle..."></textarea>
                </div>
                
                <div class="quiz-question">
                    <p>2. Calculate the MA if the Effort Arm is <strong>80cm</strong> and the Load Arm is <strong>20cm</strong>.</p>
                    <input type="number" id="exit-ma" placeholder="Enter MA">
                </div>
                
                <div class="quiz-question">
                    <p>3. Calculate the Torque if <strong>20N</strong> of force is applied at the Effort Arm (80cm). (Hint: Convert cm to m!)</p>
                    <input type="number" id="exit-torque" placeholder="Enter Torque in Nm">
                </div>
                
                <div class="quiz-question">
                    <p>4. <strong>Reflection:</strong> How could you use levers to throw an object really, really far?</p>
                    <textarea id="exit-reflection" rows="2" placeholder="Type your reflection here..."></textarea>
                </div>
            </div>

            <div class="text-center" style="margin-top: 2rem;">
                <button class="btn btn-success" id="saveWrapUpBtn">Complete Lesson & Save Reflection</button>
                <button class="btn btn-primary" id="downloadCertificateBtn" style="display: none;">Download Certificate</button>
            </div>
            
            <div id="celebration-badge" class="hidden" style="text-align: center; padding: 2rem; background: var(--gradient-success); color: white; border-radius: 10px; margin-top: 1rem;">
                <h3>üéâ Lesson Complete! üéâ</h3>
                <p>Your reflections are saved! You can now download your certificate.</p>
            </div>
        </section>

        <!-- 8. Vocabulary -->
        <section id="vocabulary">
            <h2>üìö Vocabulary List</h2>
            <p>Review the key terms from today's lesson.</p>

            <div class="vocab-list" id="vocabList">
                <!-- Vocabulary will be injected here by JavaScript -->
            </div>
        </section>

        <footer>
            <p style="text-align: center; padding: 2rem; background: var(--bg-light); color: var(--text-light); border-top: 1px solid var(--border-color);">
                IGCSE Design & Technology (0445) | Lesson Module
            </p>
        </footer>

    </div> <!-- End .container -->

    <!-- Hidden canvas for generating the certificate -->
    <canvas id="certificateCanvas" width="900" height="1300" style="display: none;"></canvas>

    <!-- Embedded JavaScript -->
    <script>
        /**
         * Main Application Object
         */
        const App = {
            // State object to hold all dynamic data
            state: {
                progress: 0,
                openingThoughts: "",
                theme: 'light',
                // New flags to lock content
                status: {
                    setup1Done: false,
                    setup2Done: false,
                    setup3Done: false,
                    ccq3Done: false,
                    ccq4Done: false,
                    skillsDone: false,
                    lessonComplete: false
                },
                ccqAnswers: { ccq1: "", ccq2: "", ccq3: "", ccq4: "", ccq5: "" },
                // Virtual Lab data (for certificate)
                virtualLab: {
                    setup1: { ma: "" },
                    setup2: { ma: "", effort: "" },
                    setup3: { ma: "" }
                },
                skillsActivity: { ma: "", effort1: "", effort2: "" },
                exitTicket: { sketch: "", ma: "", torque: "", reflection: "" },
                vocabTerms: [
                    { term: 'Lever', definition: 'A rigid bar that pivots around a fixed point (the fulcrum) to move a load.' },
                    { term: 'Fulcrum', definition: 'The fixed pivot point around which a lever rotates.' },
                    { term: 'Load', definition: 'The force or weight that is being moved or lifted by the lever.' },
                    { term: 'Effort', definition: 'The force applied to the lever to move the load.' },
                    { term: 'Mechanical Advantage (MA)', definition: 'The factor by which a mechanism multiplies force. (MA = Effort Arm / Load Arm)' },
                    { term: 'Torque (œÑ)', definition: 'A rotational force that causes an object to rotate. (Torque = Force √ó Distance)' },
                    { term: 'Principle of Moments', definition: 'For a balanced lever, the clockwise torque equals the counterclockwise torque.' },
                    { term: 'Newton-meter (Nm)', definition: 'The standard unit of torque.' }
                ]
            },

            /**
             * Initializes the application
             */
            init: function() {
                App.loadProgress();
                App.addEventListeners();
                App.initVocabulary();
                App.updateProgressBar();
                App.applyTheme();
                App.applySavedData(); // This now handles locking
            },

            /**
             * Adds all event listeners for the page
             */
            addEventListeners: function() {
                document.getElementById('themeToggle').addEventListener('click', App.toggleTheme);
                document.getElementById('saveWrapUpBtn').addEventListener('click', App.saveWrapUp);
                document.getElementById('downloadCertificateBtn').addEventListener('click', App.generateCertificate);

                // Nav link highlighting on scroll
                window.addEventListener('scroll', App.updateActiveNav);

                // Expandable sections
                document.querySelectorAll('.expandable-header').forEach(header => {
                    header.addEventListener('click', App.toggleExpand);
                });
                
                // Guided Practice: Virtual Lab
                document.getElementById('calcSetup1').addEventListener('click', App.calculateVirtualLab1);
                document.getElementById('calcSetup2').addEventListener('click', App.calculateVirtualLab2);
                document.getElementById('calcSetup3').addEventListener('click', App.calculateVirtualLab3);
                
                // Concept Check
                document.getElementById('check-ccq3').addEventListener('click', () => App.checkCalculation('ccq3-answer', 5, 'ccq3-feedback', 'Correct! MA = 2m / 0.4m = 5', 'ccq3Done'));
                document.getElementById('check-ccq4').addEventListener('click', () => App.checkCalculation('ccq4-answer', 100, 'ccq4-feedback', 'Correct! Torque = 50N * 2m = 100 Nm', 'ccq4Done'));

                // Wrap-Up: Skills Activity
                document.getElementById('check-skills').addEventListener('click', App.checkSkillsActivity);
            },
            
            /**
             * --- LOCALSTORAGE & STATE ---
             */
            saveProgress: function() {
                // Save inputs that might not be associated with a "Check" button
                App.state.openingThoughts = document.getElementById('openingThoughts').value;
                App.state.ccqAnswers.ccq1 = document.getElementById('ccq1-answer').value;
                App.state.ccqAnswers.ccq2 = document.getElementById('ccq2-answer').value;
                App.state.ccqAnswers.ccq5 = document.getElementById('ccq5-answer').value;
                
                const stateToSave = { ...App.state };
                delete stateToSave.vocabTerms; 
                localStorage.setItem('mechanismsLessonProgress', JSON.stringify(stateToSave));
            },

            loadProgress: function() {
                const savedState = localStorage.getItem('mechanismsLessonProgress');
                if (savedState) {
                    const loadedState = JSON.parse(savedState);
                    // Merge loaded state deeply
                    App.state = { 
                        ...App.state, 
                        ...loadedState,
                        status: { ...App.state.status, ...(loadedState.status || {}) },
                        ccqAnswers: { ...App.state.ccqAnswers, ...loadedState.ccqAnswers },
                        virtualLab: { ...App.state.virtualLab, ...(loadedState.virtualLab || {}) },
                        skillsActivity: { ...App.state.skillsActivity, ...loadedState.skillsActivity },
                        exitTicket: { ...App.state.exitTicket, ...loadedState.exitTicket }
                    };
                }
            },
            
            /**
             * Applies data and locks inputs if they were completed
             */
            applySavedData: function() {
                // Restore Text Areas
                if (App.state.openingThoughts) document.getElementById('openingThoughts').value = App.state.openingThoughts;
                if (App.state.ccqAnswers.ccq1) document.getElementById('ccq1-answer').value = App.state.ccqAnswers.ccq1;
                if (App.state.ccqAnswers.ccq2) document.getElementById('ccq2-answer').value = App.state.ccqAnswers.ccq2;
                if (App.state.ccqAnswers.ccq5) document.getElementById('ccq5-answer').value = App.state.ccqAnswers.ccq5;
                if (App.state.ccqAnswers.ccq3) document.getElementById('ccq3-answer').value = App.state.ccqAnswers.ccq3;
                if (App.state.ccqAnswers.ccq4) document.getElementById('ccq4-answer').value = App.state.ccqAnswers.ccq4;

                if (App.state.exitTicket.sketch) document.getElementById('exit-sketch').value = App.state.exitTicket.sketch;
                if (App.state.exitTicket.ma) document.getElementById('exit-ma').value = App.state.exitTicket.ma;
                if (App.state.exitTicket.torque) document.getElementById('exit-torque').value = App.state.exitTicket.torque;
                if (App.state.exitTicket.reflection) document.getElementById('exit-reflection').value = App.state.exitTicket.reflection;

                // Restore Virtual Lab Inputs
                // Setup 1
                if (App.state.status.setup1Done) {
                   document.getElementById('setup1-load-arm').value = "10";
                   document.getElementById('setup1-effort-arm').value = "10";
                   App.lockSection(['setup1-load-arm', 'setup1-effort-arm', 'calcSetup1'], 'setup1-feedback', 'Setup 1 Completed & Saved.', 'success');
                }
                // Setup 2
                if (App.state.status.setup2Done) {
                   document.getElementById('setup2-load-arm').value = "5";
                   document.getElementById('setup2-effort-arm').value = "15";
                   App.lockSection(['setup2-load-arm', 'setup2-effort-arm', 'calcSetup2'], 'setup2-feedback', 'Setup 2 Completed & Saved.', 'success');
                }
                // Setup 3
                if (App.state.status.setup3Done) {
                   document.getElementById('setup3-load-arm').value = "50";
                   document.getElementById('setup3-effort-arm').value = "150";
                   App.lockSection(['setup3-load-arm', 'setup3-effort-arm', 'calcSetup3'], 'setup3-feedback', 'Setup 3 Completed & Saved.', 'success');
                }
                
                // Restore Skills Inputs
                if (App.state.status.skillsDone) {
                    document.getElementById('skill-ma').value = App.state.skillsActivity.ma;
                    document.getElementById('skill-effort1').value = App.state.skillsActivity.effort1;
                    document.getElementById('skill-effort2').value = App.state.skillsActivity.effort2;
                    App.lockSection(['skill-ma', 'skill-effort1', 'skill-effort2', 'check-skills'], 'skills-feedback', 'Skills Activity Completed & Saved.', 'success');
                }

                // Restore CCQ Check Buttons
                if (App.state.status.ccq3Done) App.lockSection(['ccq3-answer', 'check-ccq3'], 'ccq3-feedback', 'Correctly Answered.', 'success');
                if (App.state.status.ccq4Done) App.lockSection(['ccq4-answer', 'check-ccq4'], 'ccq4-feedback', 'Correctly Answered.', 'success');

                // Global Lock if Lesson Completed
                if (App.state.status.lessonComplete) {
                    const saveBtn = document.getElementById('saveWrapUpBtn');
                    saveBtn.classList.add('btn-disabled');
                    saveBtn.textContent = 'Reflection Saved!';
                    document.getElementById('celebration-badge').style.display = 'block';
                    document.getElementById('downloadCertificateBtn').style.display = 'inline-block';
                    
                    // Lock all remaining inputs
                    const allInputs = document.querySelectorAll('input, textarea');
                    allInputs.forEach(el => el.disabled = true);
                }
            },

            lockSection: function(elementIds, feedbackId, feedbackMsg, type) {
                elementIds.forEach(id => {
                    const el = document.getElementById(id);
                    if(el) {
                        el.disabled = true;
                        if(el.tagName === 'BUTTON') el.classList.add('btn-disabled');
                    }
                });
                if(feedbackId) {
                    App.showFeedback(feedbackId, feedbackMsg, type);
                }
            },
            
            /**
             * --- UI & THEME ---
             */
            toggleTheme: function() {
                App.state.theme = (App.state.theme === 'light') ? 'dark' : 'light';
                App.applyTheme();
                App.saveProgress();
            },
            
            applyTheme: function() {
                const toggleBtn = document.getElementById('themeToggle');
                if (App.state.theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    toggleBtn.textContent = '‚òÄÔ∏è';
                } else {
                    document.body.classList.remove('dark-mode');
                    toggleBtn.textContent = 'üåô';
                }
            },

            updateProgressBar: function() {
                const scrollY = window.scrollY;
                const totalHeight = document.documentElement.scrollHeight - window.innerHeight;
                App.state.progress = Math.round((scrollY / totalHeight) * 100);
                
                const progressBar = document.getElementById('progressBar');
                if(progressBar) {
                    progressBar.style.width = `${App.state.progress}%`;
                    progressBar.textContent = `${App.state.progress}%`;
                }
            },
            
            updateActiveNav: function() {
                App.updateProgressBar();
                let currentSection = '';
                const sections = document.querySelectorAll('section');
                const navHeight = document.getElementById('main-nav').offsetHeight;
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop - navHeight - 150; 
                    if (window.scrollY >= sectionTop) {
                        currentSection = section.getAttribute('id');
                    }
                });

                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${currentSection}`) {
                        link.classList.add('active');
                    }
                });
            },

            toggleExpand: function(e) {
                const header = e.target.closest('.expandable-header');
                if (!header) return;

                const content = header.nextElementSibling;
                header.classList.toggle('active');
                content.classList.toggle('active');
            },
            
            showFeedback: function(elementId, message, type) {
                const feedbackEl = document.getElementById(elementId);
                if (!feedbackEl) return;
                
                feedbackEl.textContent = message;
                feedbackEl.className = `feedback ${type} show`;
            },
            
            /**
             * --- CALCULATIONS ---
             */
            calculateVirtualLab1: function() {
                const loadArm = parseFloat(document.getElementById('setup1-load-arm').value);
                const effortArm = parseFloat(document.getElementById('setup1-effort-arm').value);
                if (loadArm === 10 && effortArm === 10) {
                    const ma = effortArm / loadArm;
                    App.state.status.setup1Done = true;
                    App.state.virtualLab.setup1.ma = ma;
                    App.saveProgress();
                    App.lockSection(['setup1-load-arm', 'setup1-effort-arm', 'calcSetup1'], 'setup1-feedback', `Correct! MA = ${ma}. Saved.`, 'success');
                } else {
                    App.showFeedback('setup1-feedback', 'Not quite! Check the distances. (Hint: 15-5=10 and 25-15=10)', 'error');
                }
            },
            
            calculateVirtualLab2: function() {
                const loadArm = parseFloat(document.getElementById('setup2-load-arm').value);
                const effortArm = parseFloat(document.getElementById('setup2-effort-arm').value);
                if (loadArm === 5 && effortArm === 15) {
                    const ma = effortArm / loadArm;
                    const effort = (100 * loadArm) / effortArm; 
                    App.state.status.setup2Done = true;
                    App.state.virtualLab.setup2.ma = ma;
                    App.state.virtualLab.setup2.effort = effort.toFixed(1);
                    App.saveProgress();
                    App.lockSection(['setup2-load-arm', 'setup2-effort-arm', 'calcSetup2'], 'setup2-feedback', `Correct! MA = ${ma}. Effort = ${effort.toFixed(1)}g. Saved.`, 'success');
                } else {
                    App.showFeedback('setup2-feedback', 'Not quite! Check the distances. (Hint: 10-5=5 and 25-10=15)', 'error');
                }
            },
            
            calculateVirtualLab3: function() {
                const loadArm = parseFloat(document.getElementById('setup3-load-arm').value);
                const effortArm = parseFloat(document.getElementById('setup3-effort-arm').value);
                if (loadArm === 50 && effortArm === 150) {
                    const ma = effortArm / loadArm;
                    App.state.status.setup3Done = true;
                    App.state.virtualLab.setup3.ma = ma;
                    App.saveProgress();
                    App.lockSection(['setup3-load-arm', 'setup3-effort-arm', 'calcSetup3'], 'setup3-feedback', `Correct! MA = ${ma}. Saved.`, 'success');
                } else {
                    App.showFeedback('setup3-feedback', 'Not quite! Check the distances from the fulcrum (0cm).', 'error');
                }
            },
            
            checkCalculation: function(inputId, correctAnswer, feedbackId, successMessage, statusFlag) {
                const answer = parseFloat(document.getElementById(inputId).value);
                if (answer === correctAnswer) {
                    App.state.status[statusFlag] = true;
                    App.state.ccqAnswers[inputId.replace('-answer', '')] = answer;
                    App.saveProgress();
                    App.lockSection([inputId, `check-${inputId.replace('-answer', '')}`], feedbackId, successMessage, 'success');
                } else {
                    App.showFeedback(feedbackId, 'Incorrect, try calculating again.', 'error');
                }
            },

            checkSkillsActivity: function() {
                const ma = parseFloat(document.getElementById('skill-ma').value);
                const effort1 = parseFloat(document.getElementById('skill-effort1').value);
                const effort2 = parseFloat(document.getElementById('skill-effort2').value);
                let correct = 0;
                
                if (ma === 3) correct++;
                if (effort1 === 100) correct++;
                if (effort2 === 160) correct++;

                if (correct === 3) {
                    App.state.status.skillsDone = true;
                    App.state.skillsActivity.ma = ma;
                    App.state.skillsActivity.effort1 = effort1;
                    App.state.skillsActivity.effort2 = effort2;
                    App.saveProgress();
                    App.lockSection(['skill-ma', 'skill-effort1', 'skill-effort2', 'check-skills'], 'skills-feedback', 'All correct! Saved.', 'success');
                } else {
                    App.showFeedback('skills-feedback', `You got ${correct}/3 correct. Check your calculations! (MA = 1.5/0.5, Effort = Load / MA)`, 'error');
                }
            },

            saveWrapUp: function() {
                // Collect remaining text inputs
                App.state.ccqAnswers.ccq1 = document.getElementById('ccq1-answer').value;
                App.state.ccqAnswers.ccq2 = document.getElementById('ccq2-answer').value;
                App.state.ccqAnswers.ccq5 = document.getElementById('ccq5-answer').value;
                
                App.state.exitTicket.sketch = document.getElementById('exit-sketch').value;
                App.state.exitTicket.ma = document.getElementById('exit-ma').value;
                App.state.exitTicket.torque = document.getElementById('exit-torque').value;
                App.state.exitTicket.reflection = document.getElementById('exit-reflection').value;
                
                // Mark lesson as complete
                App.state.status.lessonComplete = true;
                App.saveProgress();

                // Lock UI
                const saveBtn = document.getElementById('saveWrapUpBtn');
                saveBtn.classList.add('btn-disabled');
                saveBtn.textContent = 'Reflection Saved!';
                document.getElementById('celebration-badge').style.display = 'block';
                document.getElementById('downloadCertificateBtn').style.display = 'inline-block';
                
                const allInputs = document.querySelectorAll('input, textarea');
                allInputs.forEach(el => el.disabled = true);
            },
            
            initVocabulary: function() {
                const vocabList = document.getElementById('vocabList');
                vocabList.innerHTML = '';
                App.state.vocabTerms.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'vocab-item';
                    el.innerHTML = `<div class="vocab-term">${item.term}</div><div class="vocab-def">${item.definition}</div>`;
                    vocabList.appendChild(el);
                });
            },

            wrapText: function(context, text, x, y, maxWidth, lineHeight) {
                if(!text) return y;
                const words = text.split(' ');
                let line = '';
                for(let n = 0; n < words.length; n++) {
                    const testLine = line + words[n] + ' ';
                    const metrics = context.measureText(testLine);
                    const testWidth = metrics.width;
                    if (testWidth > maxWidth && n > 0) {
                        context.fillText(line, x, y);
                        line = words[n] + ' ';
                        y += lineHeight;
                    } else {
                        line = testLine;
                    }
                }
                context.fillText(line, x, y);
                return y + lineHeight;
            },

            generateCertificate: function() {
                const canvas = document.getElementById('certificateCanvas');
                const ctx = canvas.getContext('2d');
                
                // 1. Background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Border
                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 10;
                ctx.strokeRect(0, 0, canvas.width, canvas.height);

                // 2. Header
                ctx.fillStyle = '#2c3e50'; 
                ctx.font = 'bold 36px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Student Activity Report', canvas.width / 2, 60);
                
                ctx.font = '24px Inter';
                ctx.fillText('Week 1: Introduction to Mechanisms & Levers', canvas.width / 2, 100);
                
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(50, 120);
                ctx.lineTo(canvas.width - 50, 120);
                ctx.stroke();

                let yPos = 160;
                const leftMargin = 60;
                const contentWidth = canvas.width - 120;
                const indent = 80;
                const indentWidth = canvas.width - 140;
                const lineHeight = 26;

                const drawSectionHeader = (title) => {
                    ctx.fillStyle = '#3498db'; 
                    ctx.font = 'bold 24px Inter';
                    ctx.textAlign = 'left';
                    ctx.fillText(title, leftMargin, yPos);
                    yPos += 35;
                };

                const drawQA = (q, a) => {
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = 'bold 16px Inter';
                    yPos = App.wrapText(ctx, q, leftMargin, yPos, contentWidth, lineHeight);
                    ctx.font = '16px Inter';
                    ctx.fillStyle = '#5a6a7a';
                    yPos = App.wrapText(ctx, a ? `> ${a}` : '> (No answer provided)', indent, yPos, indentWidth, lineHeight);
                    yPos += 15;
                };
                
                const drawLine = (label, value) => {
                     ctx.fillStyle = '#2c3e50';
                     ctx.font = '16px Inter';
                     ctx.fillText(`${label}: ${value}`, indent, yPos);
                     yPos += 24;
                };

                // --- VIRTUAL LAB ---
                drawSectionHeader('Guided Practice: Virtual Lab Results');
                const lab = App.state.virtualLab;
                if(App.state.status.setup1Done) {
                    drawLine('Setup 1 (Balanced)', `Completed (MA: ${lab.setup1.ma})`);
                } else {
                    drawLine('Setup 1 (Balanced)', 'Not Completed');
                }
                if(App.state.status.setup2Done) {
                    drawLine('Setup 2 (Advantage)', `Completed (MA: ${lab.setup2.ma}, Effort: ${lab.setup2.effort}g)`);
                } else {
                     drawLine('Setup 2 (Advantage)', 'Not Completed');
                }
                if(App.state.status.setup3Done) {
                    drawLine('Setup 3 (Class 2)', `Completed (MA: ${lab.setup3.ma})`);
                } else {
                     drawLine('Setup 3 (Class 2)', 'Not Completed');
                }
                yPos += 20;

                // --- SKILLS ACTIVITY ---
                drawSectionHeader('Skills Activity');
                if(App.state.status.skillsDone) {
                    const skills = App.state.skillsActivity;
                    drawLine('Calculated MA', skills.ma);
                    drawLine('Effort for 300N Load', `${skills.effort1} N`);
                    drawLine('Effort for 480N Load', `${skills.effort2} N`);
                } else {
                    ctx.fillStyle = '#e74c3c';
                    ctx.font = '16px Inter';
                    ctx.fillText('Activity Not Completed', indent, yPos);
                    yPos += 24;
                }
                yPos += 20;

                // --- CONCEPT CHECK ---
                drawSectionHeader('Concept Check Questions');
                drawQA('1. Max MA fulcrum placement?', App.state.ccqAnswers.ccq1);
                drawQA('2. Wheelbarrow advantage explanation?', App.state.ccqAnswers.ccq2);
                drawQA('3. MA Calculation (2m/0.4m)?', App.state.ccqAnswers.ccq3 ? `${App.state.ccqAnswers.ccq3} (Correct)` : '(Not checked)');
                drawQA('4. Torque Calculation (50N @ 2m)?', App.state.ccqAnswers.ccq4 ? `${App.state.ccqAnswers.ccq4} Nm (Correct)` : '(Not checked)');
                drawQA('5. Catapult projectile placement?', App.state.ccqAnswers.ccq5);
                yPos += 10;

                // --- EXIT TICKET ---
                drawSectionHeader('Exit Ticket & Reflection');
                drawQA('1. Class 1 Lever Sketch Desc:', App.state.exitTicket.sketch);
                drawQA('2. MA (80cm/20cm):', App.state.exitTicket.ma);
                drawQA('3. Torque (20N @ 80cm):', App.state.exitTicket.torque ? `${App.state.exitTicket.torque} Nm` : '(No answer)');
                drawQA('4. Reflection (Throwing far):', App.state.exitTicket.reflection);
                
                // Footer Line
                yPos += 30;
                ctx.strokeStyle = '#dfe4ea'; 
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(50, yPos);
                ctx.lineTo(canvas.width - 50, yPos);
                ctx.stroke();
                yPos += 30;

                ctx.fillStyle = '#5a6a7a';
                ctx.font = 'italic 14px Inter';
                ctx.textAlign = 'center';
                const date = new Date().toLocaleDateString();
                ctx.fillText(`Certificate generated on ${date}`, canvas.width / 2, yPos);

                const link = document.createElement('a');
                link.download = `mechanisms_certificate_${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }
        };

        document.addEventListener('DOMContentLoaded', App.init);
    </script>
</body>
</html>