<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IGCSE ICT 0417: Excel Foundations</title>
    <style>
        :root {
            --primary: #107c10; /* Excel Green */
            --primary-dark: #0b5a0b;
            --secondary: #2b5797;
            --accent: #f2c811;
            --bg: #f3f4f6;
            --surface: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --danger: #ef4444;
            --success: #10b981;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        [data-theme="dark"] {
            --primary: #1a8f1a;
            --primary-dark: #2ea02e;
            --bg: #111827;
            --surface: #1f2937;
            --text: #f3f4f6;
            --text-light: #9ca3af;
        }

        * {
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            line-height: 1.6;
            padding-bottom: 80px; /* Space for nav */
        }

        /* --- Header & Nav --- */
        header {
            background-color: var(--surface);
            padding: 1rem 5%;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .progress-bar-container {
            width: 150px;
            height: 10px;
            background-color: var(--bg);
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid var(--text-light);
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.5s ease;
        }

        button.theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* --- Layout --- */
        main {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        section {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            display: none; /* Hidden by default for flow */
            animation: fadeIn 0.5s ease;
        }

        section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 { color: var(--secondary); border-bottom: 2px solid var(--bg); padding-bottom: 0.5rem; }
        h3 { color: var(--text); margin-top: 1.5rem; }

        /* --- Interactive Elements --- */
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover { background-color: var(--primary-dark); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary); color: white; }
        
        .download-box {
            background: #f0fdf4;
            border: 2px dashed var(--primary);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            text-align: center;
        }

        .instruction-box {
            background: #fff;
            border: 1px solid var(--text-light);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
        }
        .instruction-box ol {
            padding-left: 1.5rem;
        }
        .instruction-box li {
            margin-bottom: 0.5rem;
        }

        .warning-box {
            background: #fffbe6;
            border-left: 5px solid #d4b106;
            padding: 1rem;
            margin: 1rem 0;
            color: #7d5a00;
            font-size: 0.95rem;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .card {
            background: var(--bg);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            cursor: pointer;
        }

        .card-content { display: none; margin-top: 0.5rem; font-size: 0.9rem; }
        .card.expanded .card-content { display: block; }
        
        .simulation-container {
            background: #e6f7e6;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px dashed var(--primary);
            text-align: center;
            color: #333;
        }

        /* --- Opening Activity --- */
        .hook-scenario {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, var(--surface), var(--bg));
        }
        
        .scenario-img {
            max-width: 100%;
            height: auto;
            margin: 1rem 0;
            border-radius: 8px;
        }

        /* --- Input Fields --- */
        input[type="text"], textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--text-light);
            border-radius: 6px;
            margin: 0.5rem 0;
            background: var(--surface);
            color: var(--text);
        }

        /* --- Vocabulary Section --- */
        .vocab-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--text-light);
            border-radius: 8px;
            padding: 1rem;
        }
        .vocab-item {
            padding: 0.5rem;
            border-bottom: 1px solid var(--bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .vocab-item:last-child { border-bottom: none; }

        /* --- CCQ & Quiz --- */
        .ccq-container {
            background-color: #e0f2fe;
            border-left: 4px solid #0284c7;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            color: #333;
        }
        
        .feedback {
            margin-top: 0.5rem;
            font-weight: bold;
            padding: 0.5rem;
            border-radius: 4px;
        }
        .feedback.correct { background-color: #d1fae5; color: #065f46; }
        .feedback.incorrect { background-color: #fee2e2; color: #991b1b; }

        /* --- Drag and Drop --- */
        .draggable-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .draggable {
            background: var(--surface);
            border: 1px solid var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: grab;
        }
        .drop-zone {
            border: 2px dashed var(--text-light);
            padding: 1rem;
            min-height: 50px;
            background: var(--bg);
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        /* --- Timer --- */
        .timer-display {
            font-size: 2rem;
            font-weight: bold;
            font-family: monospace;
            color: var(--secondary);
            margin: 1rem 0;
        }

        /* --- Bottom Nav --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--surface);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        /* Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* Spreadsheet Mini-Grid */
        .mini-grid {
            display: grid;
            grid-template-columns: 30px repeat(3, 1fr);
            gap: 1px;
            background: #ccc;
            border: 1px solid #999;
            width: 100%;
            max-width: 400px;
            margin: 1rem auto;
        }
        .grid-header, .grid-cell {
            background: var(--surface);
            padding: 4px;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text);
        }
        .grid-header { font-weight: bold; background: #e0e0e0; color: #333;}
        .grid-cell input { width: 100%; border: none; text-align: right; background: transparent; }

    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<header>
    <div class="header-title">
        <h1>IGCSE ICT: Excel Foundations</h1>
    </div>
    <div class="header-controls">
        <span>Progress:</span>
        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progressBar"></div>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Dark Mode">üåì</button>
    </div>
</header>

<main>

    <!-- SECTION 1: OPENING ACTIVITY -->
    <section id="section-1" class="active">
        <h2>1. The Human Calculator Challenge</h2>
        <div class="hook-scenario">
            <p><strong>Scenario:</strong> You are the manager of a small store. It's inventory day. You have 5,000 items to count and calculate total value for.</p>
            <div class="simulation-container">
                <p><strong>Item 1:</strong> 124 units @ $1.50</p>
                <p><strong>Item 2:</strong> 56 units @ $2.75</p>
                <p>...</p>
                <p><strong>Item 5000:</strong> 12 units @ $12.00</p>
            </div>
            <h3>Quick Guess:</h3>
            <p>How long would it take you to calculate the total value of all 5,000 items using a pencil and paper?</p>
            
            <form id="openingForm" onsubmit="saveOpening(event)">
                <label>
                    <input type="radio" name="timeGuess" value="1hour"> 1 Hour
                </label>
                <label>
                    <input type="radio" name="timeGuess" value="5hours"> 5 Hours
                </label>
                <label>
                    <input type="radio" name="timeGuess" value="1day"> 1 Full Day
                </label>
                <br><br>
                <label for="openingReflection">Why do businesses rely on software for this? (One sentence)</label>
                <textarea id="openingReflection" rows="2" placeholder="I think..." required></textarea>
                <button type="submit" class="btn">Lock In Answer</button>
            </form>
            <div id="openingFeedback" style="display:none; margin-top:1rem; color:var(--primary);">
                <p><strong>Interesting!</strong> A skilled person might take 8-10 hours manually. Excel can do it in <strong>0.03 seconds</strong>. Let's learn how to harness that power.</p>
            </div>
        </div>
    </section>

    <!-- SECTION 2: OBJECTIVES -->
    <section id="section-2">
        <h2>2. Learning Objectives</h2>
        <div class="card-grid">
            <div class="card">
                <h3>üß† Cognitive</h3>
                <ul>
                    <li>Identify the main components of the Excel interface.</li>
                    <li>Enter and format text, numbers, and currency correctly.</li>
                    <li>Construct basic formulas using arithmetic operators (+, -, *, /).</li>
                </ul>
            </div>
            <div class="card">
                <h3>ü§ù Social-Emotional</h3>
                <ul>
                    <li><strong>Precision:</strong> Develop attention to detail in data entry.</li>
                    <li><strong>Efficiency:</strong> Appreciate how automation saves human effort.</li>
                </ul>
            </div>
            <div class="card">
                <h3>‚úÖ Success Criteria</h3>
                <p>"By the end of this lesson, I will be able to turn a blank grid into a calculated invoice."</p>
            </div>
        </div>
    </section>

    <!-- SECTION 3: CONCEPT EXPLORATION -->
    <section id="section-3">
        <h2>3. Concept Exploration: The Anatomy of a Spreadsheet</h2>
        <p>Click the cards to reveal definitions.</p>
        
        <div class="card-grid">
            <div class="card" onclick="toggleCard(this)">
                <h4>The Workbook vs. Worksheet</h4>
                <div class="card-content">
                    <p>A <strong>Workbook</strong> is the file (like a notebook). A <strong>Worksheet</strong> is a single page (tab) within it.</p>
                </div>
            </div>
            <div class="card" onclick="toggleCard(this)">
                <h4>Cell Reference</h4>
                <div class="card-content">
                    <p>The address of a cell, combining Column Letter and Row Number. Example: <strong>C4</strong>, <strong>A1</strong>.</p>
                </div>
            </div>
            <div class="card" onclick="toggleCard(this)">
                <h4>Data Types</h4>
                <div class="card-content">
                    <p>Excel treats text, numbers, dates, and currency differently. Numbers align right; Text aligns left by default.</p>
                </div>
            </div>
            <div class="card" onclick="toggleCard(this)">
                <h4>Formula Bar</h4>
                <div class="card-content">
                    <p>The area at the top where you can see and edit the contents (data or formula) of the active cell.</p>
                </div>
            </div>
        </div>

        <h3 style="margin-top: 2rem;">The "Big 5" Engineering Functions</h3>
        <p>Engineers and Managers don't add numbers manually. We use these tools (Click to listen):</p>
        <div class="card-grid">
            <div class="card" onclick="speak('Sum. Adds all numbers in a range.')">
                <h4>=SUM()</h4>
                <p>Adds everything up.<br><em style="color:var(--text-light); font-size:0.9rem;">Total Cost</em></p>
            </div>
            <div class="card" onclick="speak('Average. Calculates the mean value.')">
                <h4>=AVERAGE()</h4>
                <p>Finds the mean.<br><em style="color:var(--text-light); font-size:0.9rem;">Avg Speed/Price</em></p>
            </div>
            <div class="card" onclick="speak('Max. Finds the largest number.')">
                <h4>=MAX()</h4>
                <p>Highest value.<br><em style="color:var(--text-light); font-size:0.9rem;">Most Expensive</em></p>
            </div>
            <div class="card" onclick="speak('Min. Finds the smallest number.')">
                <h4>=MIN()</h4>
                <p>Lowest value.<br><em style="color:var(--text-light); font-size:0.9rem;">Cheapest Item</em></p>
            </div>
            <div class="card" onclick="speak('Count. Counts cells with numbers.')">
                <h4>=COUNT()</h4>
                <p>How many items?<br><em style="color:var(--text-light); font-size:0.9rem;">Total Inventory</em></p>
            </div>
        </div>

        <div class="ccq-container">
            <h4>‚ö° Quick Check</h4>
            <p>If I am in column D and row 5, what is my cell reference?</p>
            <button class="btn-outline" onclick="checkQuick(this, 'D5')">5D</button>
            <button class="btn-outline" onclick="checkQuick(this, 'D5', true)">D5</button>
            <p class="feedback"></p>
        </div>
    </section>

    <!-- SECTION 4: APPLIED EXAMPLES -->
    <section id="section-4">
        <h2>4. Applied Example: Part 2 - The Procurement Challenge (Guided Practice)</h2>
        <div class="warning-box">
            <p><strong>üõë MANDATORY IGCSE REQUIREMENT:</strong> You must complete this activity in <strong>Microsoft Excel</strong>. Google Sheets is NOT allowed in the exam.</p>
        </div>
        
        <p>Let's simulate a procurement task. You will calculate the total cost for a list of items.</p>
        
        <div class="download-box">
            <h3>üì• Step 1: Download the File</h3>
            <p>Click the link below. Go to <strong>File > Download > Microsoft Excel (.xlsx)</strong></p>
            <a href="https://docs.google.com/spreadsheets/d/1Pt51KQlC7lHTWvjjxqGUnA9CgR-0eFFEDX6IVnyDglc/edit?usp=sharing" target="_blank" class="btn">üìÇ Open Class 1 Example File</a>
        </div>

        <h3>Step 2: Understanding the Logic (Quick Demo)</h3>
        <p>Before you calculate the 50 items in the file, understand the logic here:</p>
        
        <div style="display:flex; gap: 2rem; flex-wrap: wrap;">
            <div style="flex:1;">
                <div class="mini-grid">
                    <div class="grid-header"></div><div class="grid-header">A</div><div class="grid-header">B</div><div class="grid-header">C</div>
                    <div class="grid-header">1</div><div class="grid-cell">Item</div><div class="grid-cell">Price</div><div class="grid-cell">Qty</div>
                    <div class="grid-header">2</div><div class="grid-cell">Apple</div><div class="grid-cell">0.50</div><div class="grid-cell">10</div>
                    <div class="grid-header">3</div><div class="grid-cell">Total</div><div class="grid-cell" id="demo-total">?</div><div class="grid-cell"></div>
                </div>
            </div>
            <div style="flex:1;">
                <p><strong>Goal:</strong> Multiply Price by Quantity.</p>
                <ol>
                    <li>Click cell <strong>B3</strong> (where we want the result).</li>
                    <li>Type <code>=</code> to start a formula.</li>
                    <li>Click cell <strong>B2</strong> (Price).</li>
                    <li>Type <code>*</code> (asterisk for multiplication).</li>
                    <li>Click cell <strong>C2</strong> (Quantity).</li>
                    <li>Press Enter.</li>
                </ol>
                <button class="btn" onclick="runDemo()">Show Solution</button>
                <p id="demo-formula" style="font-family: monospace; color: var(--primary); font-weight: bold;"></p>
            </div>
        </div>
        
        <div class="instruction-box">
            <h3>Step 3: Execute in Excel (Activity Instructions)</h3>
            <ol>
                <li>Open the downloaded file <code>Class1_Example_11th_Term2.xlsx</code>.</li>
                <li><strong>Formatting:</strong> Select the 'Price' column. Format these cells as <strong>Currency</strong> (2 decimal places).</li>
                <li><strong>Calculation:</strong> In cell <strong>D2</strong>, calculate the total cost by multiplying the Price by the Quantity.</li>
                <li><strong>Replication:</strong> Use the autofill handle (small square in the corner of the cell) to copy this formula down for all items.</li>
                <li><strong>Grand Total:</strong> At the bottom of the 'Total' column, use the <code>=SUM()</code> function to calculate the Grand Total.</li>
                <li><strong>Save:</strong> Save your work as <code>Procurement_YourName.xlsx</code>.</li>
            </ol>
        </div>
    </section>

    <!-- SECTION 5: INTERACTIVE PRACTICE -->
    <section id="section-5">
        <h2>5. Interactive Activity: Operator Match</h2>
        <p>Drag the math symbol to its Excel equivalent.</p>
        
        <div class="draggable-container">
            <div class="draggable" draggable="true" ondragstart="drag(event)" id="drag1">√ó (Multiply)</div>
            <div class="draggable" draggable="true" ondragstart="drag(event)" id="drag2">√∑ (Divide)</div>
            <div class="draggable" draggable="true" ondragstart="drag(event)" id="drag3">+ (Add)</div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div>
                <p>Symbol: <strong>*</strong></p>
                <div class="drop-zone" ondrop="drop(event, 'drag1')" ondragover="allowDrop(event)"></div>
            </div>
            <div>
                <p>Symbol: <strong>/</strong></p>
                <div class="drop-zone" ondrop="drop(event, 'drag2')" ondragover="allowDrop(event)"></div>
            </div>
            <div>
                <p>Symbol: <strong>+</strong></p>
                <div class="drop-zone" ondrop="drop(event, 'drag3')" ondragover="allowDrop(event)"></div>
            </div>
        </div>
        <p id="dragFeedback" class="feedback"></p>
    </section>

    <!-- SECTION 6: PRACTICE & CCQs -->
    <section id="section-6">
        <h2>6. Practice Exercises & Part 3: The Formula Relay Race</h2>
        <p>Complete the formula challenges. Answer the Concept Checking Questions (CCQs) correctly to proceed.</p>

        <!-- CCQ 1: Yes/No -->
        <div class="ccq-container" id="ccq1-container">
            <h4>üõë Concept Check 1</h4>
            <p><strong>Yes or No:</strong> Can Excel calculate the result if you forget the "=" sign at the start?</p>
            <button class="btn" onclick="answerCCQ('ccq1', 'no')">No</button>
            <button class="btn" onclick="answerCCQ('ccq1', 'yes')">Yes</button>
            <p id="ccq1-feedback" class="feedback"></p>
        </div>

        <!-- Part 3: Activity 2 - The Formula Relay Race -->
        <div id="ex2-container" style="display:none;">
            <hr style="margin: 2rem 0; border-top: 2px dashed var(--text-light);">
            <h3>üèÅ Part 3: Activity 2 - The Formula Relay Race (Gamified Lab)</h3>
            <div class="warning-box">
                <p><strong>Goal:</strong> Complete the spreadsheet as fast as you can accurately. <strong>No Google Sheets! Use Excel.</strong></p>
            </div>
            
            <div class="download-box">
                <h3>üì• Download Race File</h3>
                <a href="https://docs.google.com/spreadsheets/d/16gJTkBjKtuFTILThPHszIew-TkCNd7fNmUtvD3bOupg/edit?usp=sharing" target="_blank" class="btn">üìÇ Open Relay Race File</a>
                <p><small>Remember: File > Download > Microsoft Excel</small></p>
            </div>

            <div style="background: var(--surface); padding: 1rem; border: 2px solid var(--secondary); border-radius: 8px; text-align: center;">
                <h4>‚è±Ô∏è Relay Timer</h4>
                <div class="timer-display" id="timerDisplay">00:00</div>
                <button class="btn" onclick="startTimer()">Start Race</button>
                <button class="btn-outline" onclick="stopTimer()">Stop / I'm Done!</button>
            </div>
            
            <div class="instruction-box">
                <h3>üìú Race Instructions</h3>
                <ol>
                    <li>Open <code>Class1_Exercise_11th_Term2.xlsx</code>.</li>
                    <li><strong>Total Cost:</strong> In the designated column, calculate the Total for each item (Price √ó Qty).</li>
                    <li><strong>Subtotal:</strong> Calculate the sum of all item totals.</li>
                    <li><strong>Average:</strong> Use the <code>=AVERAGE()</code> function to find the average price of the items.</li>
                    <li><strong>Max/Min:</strong> Use <code>=MAX()</code> and <code>=MIN()</code> to identify the highest and lowest quantities in your list.</li>
                    <li><strong>Formatting:</strong> Apply Currency formatting ($) to all price and cost cells.</li>
                    <li><strong>Finish:</strong> Stop the timer when your file is saved and complete.</li>
                </ol>
            </div>
        </div>

        <!-- CCQ 2: Application -->
        <div class="ccq-container" id="ccq2-container" style="display:none;">
            <h4>üõë Concept Check 2</h4>
            <p><strong>What if?</strong> If you change the value in cell B2 from 80 to 0, what happens to the result of your formula?</p>
            <button class="btn-outline" style="display:block; width:100%; margin-bottom:5px;" onclick="answerCCQ('ccq2', 'wrong')">Nothing, the formula is already calculated.</button>
            <button class="btn-outline" style="display:block; width:100%; margin-bottom:5px;" onclick="answerCCQ('ccq2', 'correct')">The result updates automatically.</button>
            <p id="ccq2-feedback" class="feedback"></p>
        </div>

    </section>

    <!-- SECTION 7: VOCABULARY -->
    <section id="section-7">
        <h2>7. Vocabulary Vault</h2>
        <input type="text" id="vocabSearch" onkeyup="filterVocab()" placeholder="Search terms...">
        <div class="vocab-list" id="vocabList">
            <!-- Populated by JS -->
        </div>
    </section>

    <!-- SECTION 8: HOMEWORK -->
    <section id="section-8">
        <h2>8. Part 4: Homework - Laboratory Budget & Shipping Logic</h2>
        <div class="warning-box">
            <p><strong>üìÖ Due:</strong> Before Next Class. <strong>Format:</strong> .xlsx (Microsoft Excel).</p>
        </div>

        <div class="card">
            <h3>Assignment Brief</h3>
            <p>You have been given a budget to set up a new computer laboratory. You must calculate costs and determine shipping logic.</p>
            
            <div class="download-box">
                <h3>üì• Download Homework File</h3>
                <a href="https://docs.google.com/spreadsheets/d/1IYtUoXluVQy6ZVacu8Dj6cHia5DZts_tneXkBHaR_7c/edit?usp=sharing" target="_blank" class="btn">üìÇ Open Homework File</a>
                <p><small>File > Download > Microsoft Excel</small></p>
            </div>

            <div class="instruction-box">
                <h3>üìã Homework Instructions</h3>
                <ol>
                    <li>Open <code>Class1_Homework_11th_Term2.xlsx</code>.</li>
                    <li><strong>Formatting:</strong> Ensure all cost and price columns are formatted as Currency ($) with 2 decimal places.</li>
                    <li><strong>Item Costs:</strong> Calculate the <code>Total Cost</code> for each hardware item (Unit Price √ó Units).</li>
                    <li><strong>Subtotal:</strong> Calculate the sum of all hardware totals to get the Lab Subtotal.</li>
                    <li><strong>Shipping Logic (Challenge):</strong> In the Shipping cell, write a formula:
                        <ul>
                            <li>If the Subtotal is <strong>greater than $20,000</strong>, Shipping is <strong>$0 (Free)</strong>.</li>
                            <li>Otherwise, Shipping is <strong>$500</strong>.</li>
                            <li><em>(Requires the IF function).</em></li>
                        </ul>
                    </li>
                    <li><strong>Grand Total:</strong> Calculate the final total (Subtotal + Shipping).</li>
                    <li><strong>Header:</strong> Insert a row at the top. Add the title <strong>"Laboratory Budget"</strong>, merge cells A1 to D1, and make it Bold/Center aligned.</li>
                </ol>
            </div>
        </div>
    </section>

    <!-- SECTION 9: WRAP-UP -->
    <section id="section-9">
        <h2>9. Wrap-Up & Reflection</h2>
        
        <!-- Objective Check -->
        <div style="margin-bottom: 2rem;">
            <h3>Did we meet our goals?</h3>
            <label style="display:block; margin:0.5rem 0;"><input type="checkbox"> I can identify Rows (Numbers) and Columns (Letters).</label>
            <label style="display:block; margin:0.5rem 0;"><input type="checkbox"> I can write a basic formula starting with =.</label>
            <label style="display:block; margin:0.5rem 0;"><input type="checkbox"> I understand why formulas are better than manual math.</label>
        </div>

        <!-- 3-2-1 Reflection -->
        <div class="card">
            <h3>3-2-1 Reflection</h3>
            <div class="form-group">
                <label>3 things I learned:</label>
                <textarea id="ref3" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>2 things I found interesting:</label>
                <textarea id="ref2" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>1 question I still have:</label>
                <textarea id="ref1" rows="2"></textarea>
            </div>
            <button class="btn" onclick="finishClass()">Submit & Finish</button>
        </div>
        
        <div id="bridge" style="display:none; margin-top:2rem; background: #fff3cd; padding:1rem; border-radius:8px;">
            <h3>üöÄ Next Class Teaser</h3>
            <p>Today we used relative references. But what if you want to multiply 100 different prices by the <strong>exact same</strong> tax rate cell? If you drag the formula, it breaks! Next time: <strong>Absolute Referencing ($)</strong>.</p>
            <div id="final-badge" style="text-align: center; margin-top: 1rem;">
                <span style="font-size: 3rem;">üèÜ</span>
                <h3>Week 1 Excel Explorer Badge Earned!</h3>
            </div>
        </div>
    </section>

</main>

<nav class="bottom-nav">
    <button class="btn-outline" id="prevBtn" onclick="changeSection(-1)">Previous</button>
    <span id="navInfo" style="align-self:center;">Step 1 of 9</span>
    <button class="btn" id="nextBtn" onclick="changeSection(1)">Next</button>
</nav>

<script>
    // --- STATE MANAGEMENT ---
    let currentSection = 1;
    const totalSections = 9;
    const vocabulary = [
        { term: "Cell Reference", def: "The coordinates of a cell (e.g., A1)." },
        { term: "Formula", def: "A mathematical equation used to calculate a value. Must start with =." },
        { term: "Function", def: "A preset formula in Excel (like SUM, AVERAGE, MAX)." },
        { term: "Range", def: "A group of selected cells (e.g., A1:A10)." },
        { term: "Active Cell", def: "The selected cell outlined in green." },
        { term: "Workbook", def: "The entire Excel file." },
        { term: "Worksheet", def: "A single page/tab within a workbook." }
    ];

    // --- INIT ---
    window.onload = function() {
        renderVocab();
        loadProgress();
        updateNav();
    };

    // --- NAVIGATION ---
    function changeSection(dir) {
        // Validation logic - Updated to check Section 6 (Practice)
        if (dir === 1 && currentSection === 6 && !ccq2Passed) {
            alert("Please complete the practice exercises and check your understanding first!");
            return;
        }

        document.getElementById(`section-${currentSection}`).classList.remove('active');
        currentSection += dir;
        
        // Bounds check
        if (currentSection < 1) currentSection = 1;
        if (currentSection > totalSections) currentSection = totalSections;

        document.getElementById(`section-${currentSection}`).classList.add('active');
        updateNav();
        saveProgress();
        window.scrollTo(0,0);
    }

    function updateNav() {
        document.getElementById('navInfo').innerText = `Step ${currentSection} of ${totalSections}`;
        document.getElementById('prevBtn').disabled = (currentSection === 1);
        document.getElementById('nextBtn').style.display = (currentSection === totalSections) ? 'none' : 'inline-block';
        
        // Progress Bar
        const percent = ((currentSection - 1) / (totalSections - 1)) * 100;
        document.getElementById('progressBar').style.width = `${percent}%`;
    }

    // --- THEME ---
    function toggleTheme() {
        const body = document.body;
        if (body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme');
        } else {
            body.setAttribute('data-theme', 'dark');
        }
    }

    // --- SECTION 1: OPENING ---
    function saveOpening(e) {
        e.preventDefault();
        const reflection = document.getElementById('openingReflection').value;
        if(reflection) {
            localStorage.setItem('openingRef', reflection);
            document.getElementById('openingFeedback').style.display = 'block';
            document.getElementById('openingForm').querySelector('button').innerText = "Saved!";
            document.getElementById('openingForm').querySelector('button').disabled = true;
        }
    }

    // --- SECTION 4: CARDS & QUICK CHECK ---
    function toggleCard(card) {
        card.classList.toggle('expanded');
    }

    function checkQuick(btn, answer, isCorrect) {
        const feedback = btn.parentElement.querySelector('.feedback');
        if (isCorrect) {
            feedback.innerText = "Correct! Column letter first, then Row number.";
            feedback.className = "feedback correct";
        } else {
            feedback.innerText = "Try again. Remember: Column Letter + Row Number.";
            feedback.className = "feedback incorrect";
        }
    }

    // --- SECTION 5: DEMO ---
    function runDemo() {
        document.getElementById('demo-total').innerText = "5.00";
        document.getElementById('demo-formula').innerText = "Formula used: =B2*C2";
    }

    // --- SECTION 6: DRAG & DROP ---
    function allowDrop(ev) { ev.preventDefault(); }
    function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
    function drop(ev, expectedId) {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("text");
        if (data === expectedId) {
            ev.target.appendChild(document.getElementById(data));
            ev.target.style.border = "2px solid green";
            document.getElementById('dragFeedback').innerText = "Correct match!";
            document.getElementById('dragFeedback').className = "feedback correct";
        } else {
            document.getElementById('dragFeedback').innerText = "Incorrect match. Try again.";
            document.getElementById('dragFeedback').className = "feedback incorrect";
        }
    }

    // --- SECTION 7: PRACTICE, RELAY & CCQS ---
    let ccq2Passed = false;
    let timerInterval;
    let startTime;

    function startTimer() {
        if(timerInterval) return; // Prevent multiple clicks
        startTime = Date.now();
        timerInterval = setInterval(() => {
            const elapsedTime = Date.now() - startTime;
            const minutes = Math.floor(elapsedTime / 60000);
            const seconds = Math.floor((elapsedTime % 60000) / 1000);
            document.getElementById('timerDisplay').innerText = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
    }

    function stopTimer() {
        if(timerInterval) clearInterval(timerInterval);
        timerInterval = null;
        alert(`You finished in ${document.getElementById('timerDisplay').innerText}! Write this time on your spreadsheet.`);
        
        // FIX: Reveal the final Concept Check so the user can proceed
        const ccq2 = document.getElementById('ccq2-container');
        ccq2.style.display = 'block';
        ccq2.scrollIntoView({ behavior: 'smooth' });
    }

    function answerCCQ(id, answer) {
        const feedback = document.getElementById(`${id}-feedback`);
        if (id === 'ccq1') {
            if (answer === 'no') {
                feedback.innerText = "Correct! Without '=', Excel treats it as plain text.";
                feedback.className = "feedback correct";
                document.getElementById('ex2-container').style.display = "block";
            } else {
                feedback.innerText = "Incorrect. The '=' tells Excel 'Do Math!'. Try again.";
                feedback.className = "feedback incorrect";
            }
        } else if (id === 'ccq2') {
            if (answer === 'correct') {
                feedback.innerText = "Spot on! That is the power of Excel: dynamic updates.";
                feedback.className = "feedback correct";
                ccq2Passed = true;
            } else {
                feedback.innerText = "Think again. Formulas refer to the CELL, not the number inside it.";
                feedback.className = "feedback incorrect";
            }
        }
    }

    // --- SECTION 8: VOCABULARY ---
    function renderVocab() {
        const list = document.getElementById('vocabList');
        list.innerHTML = "";
        vocabulary.forEach(v => {
            const item = document.createElement('div');
            item.className = 'vocab-item';
            item.innerHTML = `
                <div>
                    <strong>${v.term}</strong>: ${v.def}
                </div>
                <button class="btn-outline" style="padding:0.2rem 0.5rem; font-size:0.8rem;" onclick="speak('${v.term}')">üîä</button>
            `;
            list.appendChild(item);
        });
    }

    function filterVocab() {
        const term = document.getElementById('vocabSearch').value.toLowerCase();
        const items = document.querySelectorAll('.vocab-item');
        items.forEach(item => {
            const text = item.innerText.toLowerCase();
            item.style.display = text.includes(term) ? 'flex' : 'none';
        });
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(utterance);
        } else {
            alert("Browser does not support text-to-speech.");
        }
    }

    // --- SECTION 10: WRAP UP ---
    function finishClass() {
        // Save reflections
        localStorage.setItem('ref3', document.getElementById('ref3').value);
        localStorage.setItem('ref2', document.getElementById('ref2').value);
        localStorage.setItem('ref1', document.getElementById('ref1').value);

        // Show bridge and confetti
        document.getElementById('bridge').style.display = "block";
        document.querySelector('#section-9 .btn').style.display = "none";
        triggerConfetti();
    }

    // --- UTILS ---
    function saveProgress() {
        localStorage.setItem('excelClassPage', currentSection);
    }

    function loadProgress() {
        const saved = localStorage.getItem('excelClassPage');
        if (saved) {
            currentSection = parseInt(saved);
            // Reset UI to correct section
            document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
            document.getElementById(`section-${currentSection}`).classList.add('active');
        }
    }

    // Simple Confetti Implementation
    function triggerConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const pieces = [];
        const colors = ['#107c10', '#f2c811', '#2b5797', '#ef4444'];
        
        for(let i=0; i<100; i++) {
            pieces.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: colors[Math.floor(Math.random() * colors.length)],
                size: Math.random() * 10 + 5,
                speed: Math.random() * 5 + 2
            });
        }

        function animate() {
            ctx.clearRect(0,0, canvas.width, canvas.height);
            pieces.forEach(p => {
                p.y += p.speed;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                if(p.y > canvas.height) p.y = -10;
            });
            requestAnimationFrame(animate);
        }
        animate();
        setTimeout(() => { canvas.style.display = 'none'; }, 5000);
    }

</script>
</body>
</html>