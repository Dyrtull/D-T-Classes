<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IGCSE ICT: Automated Selection & Lookups</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --text: #1e293b;
            --card-bg: #ffffff;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary: #3b82f6;
            --primary-dark: #60a5fa;
            --secondary: #34d399;
            --bg: #0f172a;
            --text: #f1f5f9;
            --card-bg: #1e293b;
            --border: #334155;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            transition: var(--transition);
        }

        /* --- Layout & Nav --- */
        header {
            background: var(--card-bg);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-container {
            flex-grow: 1;
            margin: 0 2rem;
            background: var(--border);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            max-width: 400px;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.5s ease;
        }

        .theme-toggle {
            background: none;
            border: 2px solid var(--border);
            color: var(--text);
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- Sections --- */
        main {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
            min-height: 80vh;
        }

        section {
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease;
        }

        section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 {
            color: var(--text);
            margin-bottom: 1rem;
        }

        h1 { font-size: 2.5rem; letter-spacing: -0.05em; }
        h2 { font-size: 1.8rem; border-left: 4px solid var(--primary); padding-left: 1rem; margin-top: 2rem;}

        /* --- Cards & Content --- */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
            h1 { font-size: 1.8rem; }
            .progress-container { display: none; }
        }

        /* --- Buttons --- */
        .btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary); color: white; }
        
        .nav-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        /* --- Interactive Specifics --- */
        
        /* Opening Activity */
        .race-container {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .race-box {
            flex: 1;
            background: var(--card-bg);
            border: 2px solid var(--border);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .race-input {
            width: 100%;
            padding: 0.5rem;
            margin: 0.5rem 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .timer-display {
            font-size: 2rem;
            font-weight: bold;
            font-family: monospace;
            color: var(--danger);
        }

        /* Concept Cards */
        .concept-card {
            cursor: pointer;
            transition: var(--transition);
        }
        .concept-card:hover { transform: scale(1.02); border-color: var(--primary); }
        .concept-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .concept-card.expanded .concept-details { max-height: 500px; }

        /* Syntax Highlight */
        .code-block {
            background: #2d2d2d;
            color: #ccc;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            overflow-x: auto;
        }
        .hl-func { color: #569cd6; font-weight: bold; }
        .hl-arg { color: #9cdcfe; }
        .hl-punc { color: #d4d4d4; }
        .hl-val { color: #ce9178; }

        /* CCQ & Quizzes */
        .ccq-container {
            background: rgba(37, 99, 235, 0.1);
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 0 8px 8px 0;
        }
        .quiz-option {
            display: block;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        .quiz-option:hover { border-color: var(--primary); }
        .quiz-option.selected { border-color: var(--primary); background: rgba(37, 99, 235, 0.1); }
        .quiz-option.correct { border-color: var(--secondary); background: rgba(16, 185, 129, 0.1); }
        .quiz-option.incorrect { border-color: var(--danger); background: rgba(239, 68, 68, 0.1); }
        
        .feedback-msg {
            margin-top: 1rem;
            font-weight: 600;
            display: none;
        }

        /* Vocab */
        .vocab-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        .vocab-item {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .speaker-icon {
            cursor: pointer;
            margin-left: 0.5rem;
            font-size: 1.2rem;
        }

        /* Wrap Up Badge */
        .badge-container {
            text-align: center;
            padding: 2rem;
            border: 4px dashed var(--accent);
            border-radius: 12px;
            margin-top: 2rem;
            background: radial-gradient(circle, var(--card-bg) 0%, var(--bg) 100%);
            display: none;
        }
        .badge-icon { font-size: 4rem; margin-bottom: 1rem; }

        /* Utilities */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-4 { margin-top: 1rem; }
        .tag {
            background: var(--secondary);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

<header>
    <div class="brand">
        <span>üìä</span> IGCSE ICT: Lookups
    </div>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Dark Mode">
        üåì
    </button>
</header>

<main>

    <!-- SECTION 1: OPENING ACTIVITY -->
    <section id="s1" class="active">
        <div class="card text-center">
            <h1>Week 2: Automated Selection</h1>
            <p><strong>Topic:</strong> VLOOKUP, HLOOKUP & Nested IFs</p>
            <p><strong>Duration:</strong> 90 Minutes</p>
        </div>

        <div class="card">
            <h2>üèéÔ∏è Opening Challenge: Man vs. Machine</h2>
            <p><strong>Scenario:</strong> You are a warehouse manager. You need to find the price of 5 items. Let's see who is faster: You (Manual) or the Computer (Automated).</p>
            
            <div class="race-container">
                <!-- Manual Side -->
                <div class="race-box">
                    <h3>üë§ You (Manual)</h3>
                    <p>Find "Part A-101" in the list below and type the price.</p>
                    <div style="height: 100px; overflow-y: scroll; border:1px solid #ccc; margin:10px 0; font-size:0.8rem; text-align:left; padding:5px;">
                        Part A-100: $10.50<br>
                        Part A-101: $12.75<br>
                        Part A-102: $9.20<br>
                        Part B-200: $45.00<br>
                        Part B-201: $47.50<br>
                        Part C-300: $102.00
                    </div>
                    <input type="number" id="manualInput" class="race-input" placeholder="Enter Price">
                    <button class="btn" onclick="checkManual()">Submit</button>
                </div>

                <!-- Auto Side -->
                <div class="race-box">
                    <h3>ü§ñ Computer (VLOOKUP)</h3>
                    <p>Click the button to run the VLOOKUP function.</p>
                    <div class="code-block" style="margin: 20px 0;">
                        =VLOOKUP("A-101", Data, 2, FALSE)
                    </div>
                    <button class="btn btn-outline" id="autoBtn" onclick="runAuto()">Run Function</button>
                    <p id="autoResult" style="margin-top:10px; font-weight:bold;"></p>
                </div>
            </div>
            
            <div id="hookFeedback" class="hidden" style="margin-top: 1rem; padding: 1rem; background: var(--border); border-radius: 8px;">
                <p><strong>Observation:</strong> <span id="raceWinner"></span></p>
                <p>Imagine doing this for 10,000 items. Manual entry creates errors and takes forever. VLOOKUP takes milliseconds. Today, we automate the "Librarian".</p>
                <div class="mt-4">
                    <label>How confident do you feel about Excel formulas right now?</label><br>
                    <input type="range" id="confidenceStart" min="1" max="5" style="width:100%">
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem;">
                        <span>Terrified üò±</span>
                        <span>Expert ü§ì</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-controls">
            <span></span>
            <button class="btn" onclick="nextSection(1)">Start Learning &rarr;</button>
        </div>
    </section>

    <!-- SECTION 2: OBJECTIVES -->
    <section id="s2">
        <h2>üéØ Learning Objectives</h2>
        <div class="grid-2">
            <div class="card">
                <h3>üß† Cognitive Goals (IGCSE)</h3>
                <ul style="padding-left: 1.5rem; list-style-type: disc;">
                    <li><strong>VLOOKUP:</strong> Retrieve data vertically using exact matches (FALSE).</li>
                    <li><strong>HLOOKUP:</strong> Apply horizontal lookups for matrix-style data.</li>
                    <li><strong>Nested IF:</strong> Construct logic trees (IF inside IF) for decision making.</li>
                    <li><strong>Data Integrity:</strong> Master Absolute Referencing (<code>$</code>) to prevent errors.</li>
                </ul>
            </div>
            <div class="card">
                <h3>‚ù§Ô∏è Social-Emotional Goals</h3>
                <ul style="padding-left: 1.5rem; list-style-type: disc;">
                    <li><strong>Systematic Thinking:</strong> Debug complex formulas step-by-step.</li>
                    <li><strong>Resilience:</strong> Don't panic when you see <code>#N/A</code>. It's just a clue!</li>
                </ul>
            </div>
        </div>

        <div class="nav-controls">
            <button class="btn btn-outline" onclick="prevSection(2)">&larr; Back</button>
            <button class="btn" onclick="nextSection(2)">Explore Concepts &rarr;</button>
        </div>
    </section>

    <!-- SECTION 3: CONCEPT EXPLORATION -->
    <section id="s3">
        <h2>üîç Concept Exploration</h2>
        
        <div class="card">
            <h3>The Two Lookups</h3>
            <p>Click the cards to see how the "Librarian" searches.</p>
            <div class="grid-2">
                <div class="concept-card card" onclick="toggleCard(this)">
                    <h4>‚¨áÔ∏è VLOOKUP (Vertical)</h4>
                    <p>Searches down the <strong>First Column</strong>.</p>
                    <div class="concept-details">
                        <p>Use when your headers are at the <strong>top</strong> and data grows <strong>down</strong>.</p>
                        <div class="code-block">
                            =VLOOKUP(lookup_value, table_array, col_index_num, [range_lookup])
                        </div>
                        <ul>
                            <li><strong>Value:</strong> What ID do I have?</li>
                            <li><strong>Table:</strong> Where is the catalog?</li>
                            <li><strong>Col:</strong> Which column has the answer?</li>
                            <li><strong>Range:</strong> FALSE (Exact match).</li>
                        </ul>
                    </div>
                </div>
                <div class="concept-card card" onclick="toggleCard(this)">
                    <h4>‚û°Ô∏è HLOOKUP (Horizontal)</h4>
                    <p>Searches across the <strong>Top Row</strong>.</p>
                    <div class="concept-details">
                        <p>Use when your headers are on the <strong>left</strong> and data grows <strong>right</strong> (like a timeline or size chart).</p>
                        <div class="code-block">
                            =HLOOKUP(lookup_value, table_array, row_index_num, [range_lookup])
                        </div>
                        <p>It works exactly the same, but you count <strong>Rows</strong> instead of Columns.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>üîí The Golden Rule: Absolute Referencing ($)</h3>
            <p>When you drag a formula down, Excel moves the references relative to the new position. This breaks Lookups!</p>
            <div style="background:#fff3cd; padding:1rem; border-radius:8px; border-left:4px solid #f59e0b;">
                <strong>Key Concept:</strong> Press <code>F4</code> (Windows) or <code>Cmd+T</code> (Mac) to add dollars signs.
                <br><code>A1:B10</code> becomes <code>$A$1:$B$10</code>. This locks the library shelves in place so they don't move when you copy the formula.
            </div>
        </div>

        <!-- CCQ 1 -->
        <div class="ccq-container">
            <h4>ü§î Concept Check #1</h4>
            <p>Why do we almost always use <strong>FALSE</strong> at the end of a VLOOKUP for Part IDs?</p>
            <div id="ccq1-options"></div>
            <p id="ccq1-feedback" class="feedback-msg"></p>
        </div>

        <div class="nav-controls">
            <button class="btn btn-outline" onclick="prevSection(3)">&larr; Back</button>
            <button class="btn" onclick="nextSection(3)">Applied Examples &rarr;</button>
        </div>
    </section>

    <!-- SECTION 4: APPLIED EXAMPLES (Activity Guide) -->
    <section id="s4">
        <h2>üõ†Ô∏è Applied Activities</h2>
        
        <div class="card">
            <h3>üìÇ Step 1: Download Your Mission Files</h3>
            <p><strong>Scenario:</strong> You are the Data Specialist. You have a database of parts and a list of orders. Your job is to connect them.</p>
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:10px; text-align:center;">
                <div style="padding:10px; border:1px solid var(--border); border-radius:8px;">
                    <h4>1. The Database</h4>
                    <p style="font-size:0.8rem; color:#666;">Source Reference (Keep Open!)</p>
                    <a href="https://docs.google.com/spreadsheets/d/1zUvOv7l-6BjcsISAIaG629v0-2E1itH-fWjjkfbAKGs/edit?usp=sharing" target="_blank" class="btn btn-outline" style="width:100%">Download CSV 1</a>
                </div>
                <div style="padding:10px; border:1px solid var(--border); border-radius:8px;">
                    <h4>2. Class Activity</h4>
                    <p style="font-size:0.8rem; color:#666;">Robot Design Sheet</p>
                    <a href="https://docs.google.com/spreadsheets/d/1cQ_jbbmVoJ7irxnmKrfyXmMlIg5JLVcX58MvDYxT1I4/edit?usp=sharing" target="_blank" class="btn btn-outline" style="width:100%">Download CSV 2</a>
                </div>
                <div style="padding:10px; border:1px solid var(--border); border-radius:8px;">
                    <h4>3. Homework</h4>
                    <p style="font-size:0.8rem; color:#666;">Logistics Sheet</p>
                    <a href="https://docs.google.com/spreadsheets/d/1F4iLP3xPq0FAKge78gH8OIglr6hVJdnkvBVMusix0iU/edit?usp=sharing" target="_blank" class="btn btn-outline" style="width:100%">Download CSV 3</a>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>ü§ñ Class Mission: The Robot Spec Sheet</h3>
            <p><strong>Files Required:</strong> File 1 (Database) & File 2 (Robot Sheet).</p>
            <p><strong>Setup:</strong> Open BOTH files. Save File 2 as an Excel Workbook (.xlsx).</p>
            
            <div style="margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">
                <h4>Part A: VLOOKUP (Vertical)</h4>
                <p><strong>Goal:</strong> Fill in the technical specs (Cols C, D, E, F) in the <em>Robot Sheet</em> using data from the <em>Database</em>.</p>
                <div class="code-block">=VLOOKUP(B10, [Source.csv]$A$2:$G$30, 2, FALSE)</div>
                <ul style="font-size: 0.9rem; margin-left: 1.5rem; margin-top: 0.5rem;">
                    <li><strong>Lookup Value:</strong> The Part ID (B10) in your Robot Sheet.</li>
                    <li><strong>Table Array:</strong> Highlight A2:G30 in the Database file. <strong>PRESS F4 TO LOCK IT ($)!</strong></li>
                    <li><strong>Col Index:</strong> Change this for each column (Name=2, Voltage=4, Cost=6).</li>
                </ul>
            </div>

            <div style="margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">
                <h4>Part B: HLOOKUP (Horizontal)</h4>
                <p><strong>Goal:</strong> Get Supplier Ratings (Col K). The table is horizontal in the Database (Rows 35-40).</p>
                <div class="code-block">=HLOOKUP(G10, [Source.csv]$A$35:$F$40, 3, FALSE)</div>
                <p style="font-size:0.9rem;"><em>Note: We use Row Index 3 because the Quality Rating is in the 3rd row of the highlighted table.</em></p>
            </div>

             <div>
                <h4>Part C: The Logic Gate (Nested IF)</h4>
                <p><strong>Goal:</strong> Approve or Reject based on Voltage AND Quality.</p>
                <p><em>Rule: Reject if Voltage > 6V ("DANGER"). Reject if Quality is "Low". Otherwise Approve.</em></p>
                <div class="code-block">=IF(J10="DANGER", "REJECT-VOLT", IF(K10="Low", "REJECT-QUAL", "APPROVED"))</div>
            </div>
        </div>

        <div class="card" style="border-left: 4px solid var(--accent);">
            <h3>üöö Homework Mission: Logistics Manager</h3>
            <p><strong>File Required:</strong> File 3 (Logistics Sheet) ONLY.</p>
            <p><strong>Context:</strong> You have orders to ship. The lookup tables are hidden at the bottom of the same sheet.</p>
            
            <ol style="margin-left:1.5rem; line-height: 1.8;">
                 <li><strong>Clean Up:</strong> Scroll down to find the Vertical Product Table and Horizontal Zone Table.</li>
                 <li><strong>Specs:</strong> Use VLOOKUP to get Weight and Dimensions from the Product Table.</li>
                 <li><strong>Shipping Cost:</strong> Use HLOOKUP to find the "Zone Rate" based on the destination (Zone A, B, etc).</li>
                 <li><strong>Formatting:</strong> Format all monetary values (Costs, Rates, Totals) as <strong>Currency ($)</strong> with 2 decimal places.</li>
                 <li><strong>Approval Code (The Challenge):</strong> Implement the Corporate Policy using a Nested IF:
                    <ul style="list-style-type: circle; margin-left: 1.5rem; font-size: 0.9rem; margin-top: 0.5rem;">
                        <li><strong>Step 1:</strong> Check if the <strong>Total</strong> is greater than <code>2000</code>. If TRUE, display <code>"EXEC_REVIEW"</code>.</li>
                        <li><strong>Step 2:</strong> If FALSE, check if the <strong>Total</strong> is greater than <code>500</code>. If TRUE, display <code>"MGR_REVIEW"</code>.</li>
                        <li><strong>Step 3:</strong> If both are FALSE (meaning it is 500 or less), display <code>"AUTO_APPROVE"</code>.</li>
                    </ul>
                 </li>
            </ol>
            
            <div style="background: #fee2e2; border-left: 4px solid #ef4444; color: #991b1b; padding: 1rem; margin-top: 1rem; border-radius: 4px;">
                <strong>‚ö†Ô∏è Automatic Grading Warning:</strong>
                <p style="margin-top: 0.5rem; font-size: 0.9rem;">Your file will be graded by a Python script. 
                <br>1. Do NOT insert new rows or columns.
                <br>2. Do NOT change any text labels or headers.
                <br>3. Ensure your formulas are in the exact cells specified.
                <br><strong>Any change to the structure of the file will be counted as a mistake (Grade: 1).</strong></p>
            </div>
        </div>

         <!-- CCQ 2 -->
         <div class="ccq-container">
            <h4>ü§î Concept Check #2 (Negative Checking)</h4>
            <p>Would it be correct to say that you <strong>must</strong> use an <code>AND</code> function inside the IF to check both voltage and quality?</p>
            <div id="ccq2-options"></div>
            <p id="ccq2-feedback" class="feedback-msg"></p>
        </div>

        <div class="nav-controls">
            <button class="btn btn-outline" onclick="prevSection(4)">&larr; Back</button>
            <button class="btn" onclick="nextSection(4)">Interactive Practice &rarr;</button>
        </div>
    </section>

    <!-- SECTION 5: INTERACTIVE PRACTICE -->
    <section id="s5">
        <h2>üéÆ Practice Simulator</h2>
        <p>Before you dive into Excel, prove you know the syntax structure here.</p>

        <div class="card">
            <h3>Challenge 1: Build the VLOOKUP</h3>
            <p>Construct a formula to find the Price (Col 3) for item "X-99" in range A1:D50.</p>
            
            <div style="background: #eee; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <span>=VLOOKUP(</span>
                <select id="p1-val" class="race-input" style="width: auto; display:inline-block;">
                    <option value="">(Select Value)</option>
                    <option value="range">A1:D50</option>
                    <option value="val">"X-99"</option>
                    <option value="col">3</option>
                </select>
                <span>, </span>
                <select id="p1-range" class="race-input" style="width: auto; display:inline-block;">
                    <option value="">(Select Range)</option>
                    <option value="range">$A$1:$D$50</option>
                    <option value="range_bad">A1:D50</option>
                    <option value="val">"X-99"</option>
                </select>
                <span>, </span>
                <select id="p1-col" class="race-input" style="width: auto; display:inline-block;">
                    <option value="">(Select Col)</option>
                    <option value="val">"X-99"</option>
                    <option value="col">3</option>
                    <option value="range">A1:D50</option>
                </select>
                <span>, </span>
                <select id="p1-logic" class="race-input" style="width: auto; display:inline-block;">
                    <option value="">(Select Logic)</option>
                    <option value="true">TRUE</option>
                    <option value="false">FALSE</option>
                </select>
                <span>)</span>
            </div>
            
            <button class="btn" onclick="checkPractice1()">Check Syntax</button>
            <div id="p1-feedback" class="feedback-msg"></div>
            
            <div style="margin-top:1rem;">
                <button class="btn-outline" style="font-size:0.8rem; padding:0.4rem;" onclick="toggleHint('h1')">üí° Need a Hint?</button>
                <p id="h1" class="hidden" style="color:var(--primary); font-style:italic; margin-top:5px;">Hint: Remember the order: Who? Where? Which Column? Exact Match?</p>
            </div>
        </div>

        <div class="card">
            <h3>Challenge 2: Debugging Logic</h3>
            <p>You see <code>#N/A</code> in your spreadsheet. Select all possible reasons.</p>
            <div id="debug-quiz"></div>
            <button class="btn mt-4" onclick="checkDebug()">Diagnose</button>
            <p id="debug-feedback" class="feedback-msg"></p>
        </div>

        <!-- CCQ 3 -->
        <div class="ccq-container">
            <h4>ü§î Concept Check #3 (Application)</h4>
            <p>If you have a horizontal table (Headers in Row 1, Data in Row 2), but you accidentally use VLOOKUP, what will happen?</p>
            <div id="ccq3-options"></div>
            <p id="ccq3-feedback" class="feedback-msg"></p>
        </div>

        <div class="nav-controls">
            <button class="btn btn-outline" onclick="prevSection(5)">&larr; Back</button>
            <button class="btn" onclick="nextSection(5)">Synthesis & Wrap Up &rarr;</button>
        </div>
    </section>

    <!-- SECTION 6 (Merged into flow), SECTION 7 & 8: SYNTHESIS & WRAP UP -->
    <section id="s6">
        <h2>üß© Synthesis & Wrap-Up</h2>

        <div class="card">
            <h3>Concept Map: When to use what?</h3>
            <p>Click the correct path for the scenario.</p>
            <div style="display:flex; justify-content:space-around; text-align:center;">
                <div style="flex:1;">
                    <p><strong>Headers are on Top</strong></p>
                    <button class="btn btn-outline" onclick="alert('Correct! VLOOKUP is for vertical data.')">VLOOKUP</button>
                </div>
                <div style="border-left:2px solid var(--border);"></div>
                <div style="flex:1;">
                    <p><strong>Headers are on Left</strong></p>
                    <button class="btn btn-outline" onclick="alert('Correct! HLOOKUP is for horizontal data.')">HLOOKUP</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>üìù 3-2-1 Reflection</h3>
            <div class="grid-2">
                <div>
                    <label>3 things I learned:</label>
                    <textarea class="race-input" id="ref3" rows="3"></textarea>
                </div>
                <div>
                    <label>2 things I found interesting:</label>
                    <textarea class="race-input" id="ref2" rows="3"></textarea>
                </div>
                <div style="grid-column: span 2">
                    <label>1 Question I still have:</label>
                    <textarea class="race-input" id="ref1" rows="2"></textarea>
                </div>
            </div>
            <button class="btn mt-4" onclick="saveReflection()">Save Reflection</button>
        </div>

        <div class="card">
            <h3>üåâ Bridge to Next Lesson</h3>
            <p><strong>Teaser:</strong> In the homework, you used <code>IF(Total > 2000...)</code>. But what if we want to count <em>how many</em> orders were over $2000 without filtering?</p>
            <p><strong>Next Class:</strong> COUNTIF and SUMIF - The power of conditional math.</p>
        </div>

        <div id="badgeArea" class="badge-container">
            <div class="badge-icon">üèÖ</div>
            <h3>Lookup Master Badge Earned!</h3>
            <p>You have completed the Week 2 Module.</p>
            <p id="finalScoreDisplay"></p>
        </div>

        <div class="nav-controls">
            <button class="btn btn-outline" onclick="prevSection(6)">&larr; Back</button>
            <button class="btn" onclick="nextSection(7)">Vocabulary & Extension &rarr;</button>
        </div>
    </section>

    <!-- SECTION 9: VOCABULARY & EXTENSION -->
    <section id="s7">
        <h2>üìö Vocabulary & Extension</h2>
        
        <div class="card">
            <h3>Interactive Glossary</h3>
            <input type="text" id="vocabSearch" class="race-input" placeholder="Search terms..." onkeyup="filterVocab()">
            <div class="vocab-grid mt-4" id="vocabGrid">
                <!-- Populated by JS -->
            </div>
        </div>

        <div class="card">
            <h3>üöÄ Extension: Homework & Advanced</h3>
            <p><strong>Homework Task:</strong> Complete <code>Week2_Homework_Logistics.csv</code>. Remember the Corporate Approval Logic!</p>
            <div class="code-block">
                Check Logic: >2000? -> "EXEC", >500? -> "MGR", Else -> "AUTO"
            </div>
            <p class="mt-4"><strong>Advanced Challenge:</strong> Try using <code>INDEX</code> and <code>MATCH</code> instead of VLOOKUP. It's more flexible! Look it up for extra credit.</p>
        </div>

        <div class="nav-controls">
             <button class="btn btn-outline" onclick="prevSection(7)">&larr; Back</button>
        </div>
    </section>

</main>

<footer>
    <div style="text-align: center; padding: 2rem; color: #666; border-top: 1px solid var(--border);">
        <p>IGCSE ICT 0417 | Week 2 Class 2 Resource</p>
        <p><small>Progress saved automatically.</small></p>
    </div>
</footer>

<script>
    // --- STATE MANAGEMENT ---
    const TOTAL_SECTIONS = 7;
    let currentSection = 1;
    let progress = 0;
    
    // Data Structure for CCQs
    const questions = [
        {
            id: 'ccq1',
            text: "Why use FALSE in VLOOKUP?",
            options: [
                { text: "To find the closest number", correct: false },
                { text: "To find an exact match of the ID", correct: true },
                { text: "Because the data is sorted", correct: false }
            ],
            feedback: { correct: "Correct! IDs are unique keys, so we need an exact match.", incorrect: "Incorrect. We use TRUE for ranges (like grades), but FALSE for unique IDs." }
        },
        {
            id: 'ccq2',
            text: "Do you NEED 'AND' inside the IF?",
            options: [
                { text: "Yes, otherwise it breaks.", correct: false },
                { text: "No, Nested IFs process sequentially.", correct: true }
            ],
            feedback: { correct: "Exactly! If the first IF is false, the second IF runs. No need for AND if structured correctly.", incorrect: "Not quite. Nested IFs act like a flowchart. If A happens, stop. If not, check B." }
        },
        {
            id: 'ccq3',
            text: "Using VLOOKUP on Horizontal Data?",
            options: [
                { text: "It works fine.", correct: false },
                { text: "It returns the first row only.", correct: false },
                { text: "It will look for the value in the first column (The Headers) and fail.", correct: true }
            ],
            feedback: { correct: "Spot on! VLOOKUP searches vertical columns. It won't find data in a horizontal row.", incorrect: "Review the difference between Rows (Horizontal) and Columns (Vertical)." }
        }
    ];

    const vocabList = [
        { term: "VLOOKUP", def: "Vertical Lookup. Searches for a value in the first column of a table array and returns a value in the same row." },
        { term: "HLOOKUP", def: "Horizontal Lookup. Searches for a value in the top row of a table array." },
        { term: "Absolute Reference", def: "Using $ signs (e.g., $A$1) to lock a cell reference so it doesn't change when copied." },
        { term: "Table Array", def: "The range of cells that contains the data you want to search through." },
        { term: "Nested IF", def: "Placing one IF function inside another to test multiple conditions." },
        { term: "#N/A", def: "Error meaning 'Not Available'. Usually means the lookup value wasn't found." }
    ];

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        loadProgress();
        renderCCQs();
        renderVocab();
        updateProgressBar();
    });

    // --- NAVIGATION ---
    function nextSection(currentId) {
        document.getElementById(`s${currentId}`).classList.remove('active');
        document.getElementById(`s${currentId + 1}`).classList.add('active');
        currentSection = currentId + 1;
        window.scrollTo(0, 0);
        updateProgressBar();
        saveProgress();
    }

    function prevSection(currentId) {
        document.getElementById(`s${currentId}`).classList.remove('active');
        document.getElementById(`s${currentId - 1}`).classList.add('active');
        currentSection = currentId - 1;
        window.scrollTo(0, 0);
    }

    function updateProgressBar() {
        const pct = (currentSection / TOTAL_SECTIONS) * 100;
        document.getElementById('progressBar').style.width = `${pct}%`;
    }

    // --- OPENING ACTIVITY ---
    function checkManual() {
        const val = document.getElementById('manualInput').value;
        if(val == "12.75") {
            document.getElementById('hookFeedback').classList.remove('hidden');
            document.getElementById('raceWinner').innerText = "You got it! But it took a few seconds.";
        } else {
            alert("Incorrect price. Look carefully at A-101!");
        }
    }

    function runAuto() {
        document.getElementById('autoResult').innerText = "Result: $12.75 (Time: 0.01s)";
        document.getElementById('hookFeedback').classList.remove('hidden');
        if(!document.getElementById('raceWinner').innerText) {
            document.getElementById('raceWinner').innerText = "The Computer won! Instant and accurate.";
        }
    }

    // --- INTERACTIVITY ---
    function toggleCard(card) {
        card.classList.toggle('expanded');
    }

    function toggleHint(id) {
        document.getElementById(id).classList.toggle('hidden');
    }

    function renderCCQs() {
        questions.forEach(q => {
            const container = document.getElementById(`${q.id}-options`);
            if(!container) return;
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('div');
                btn.className = 'quiz-option';
                btn.innerText = opt.text;
                btn.onclick = () => checkCCQ(q.id, idx, opt.correct);
                container.appendChild(btn);
            });
        });
    }

    function checkCCQ(qid, idx, isCorrect) {
        const container = document.getElementById(`${qid}-options`);
        const feedback = document.getElementById(`${qid}-feedback`);
        const qData = questions.find(q => q.id === qid);
        
        // Visual feedback
        const opts = container.children;
        for(let i=0; i<opts.length; i++) {
            opts[i].classList.remove('selected', 'correct', 'incorrect');
            if(i === idx) {
                opts[i].classList.add(isCorrect ? 'correct' : 'incorrect');
            }
        }

        feedback.style.display = 'block';
        feedback.innerText = isCorrect ? qData.feedback.correct : qData.feedback.incorrect;
        feedback.style.color = isCorrect ? 'var(--secondary)' : 'var(--danger)';
        
        saveProgress();
    }

    // --- PRACTICE SIMULATOR ---
    function checkPractice1() {
        const v = document.getElementById('p1-val').value;
        const r = document.getElementById('p1-range').value;
        const c = document.getElementById('p1-col').value;
        const l = document.getElementById('p1-logic').value;
        const fb = document.getElementById('p1-feedback');

        if (v === 'val' && r === 'range' && c === 'col' && l === 'false') {
            fb.innerText = "Correct Syntax! =VLOOKUP(Value, Locked_Range, Col_Index, FALSE)";
            fb.style.color = "var(--secondary)";
            fb.style.display = "block";
        } else {
            fb.innerText = "Not quite. Check: Did you lock the range ($)? Are the parameters in the right order?";
            fb.style.color = "var(--danger)";
            fb.style.display = "block";
        }
    }

    // Debugging Quiz
    const debugOptions = [
        { text: "Lookup value not in first column", correct: true },
        { text: "Table array reference not locked ($)", correct: true },
        { text: "Typo in lookup value (extra space)", correct: true },
        { text: "Computer is tired", correct: false }
    ];

    function renderDebug() {
        const container = document.getElementById('debug-quiz');
        debugOptions.forEach((opt, i) => {
            const div = document.createElement('div');
            div.innerHTML = `<label style="display:block; margin:5px 0;"><input type="checkbox" id="dbg${i}"> ${opt.text}</label>`;
            container.appendChild(div);
        });
    }
    renderDebug();

    function checkDebug() {
        let allCorrect = true;
        debugOptions.forEach((opt, i) => {
            const checked = document.getElementById(`dbg${i}`).checked;
            if(checked !== opt.correct) allCorrect = false;
        });
        
        const fb = document.getElementById('debug-feedback');
        fb.style.display = 'block';
        if(allCorrect) {
            fb.innerText = "Excellent Diagnostics! These are the 3 most common reasons for #N/A.";
            fb.style.color = "var(--secondary)";
        } else {
            fb.innerText = "Look closely. Machines don't get tired, but humans make typos and forget $ signs.";
            fb.style.color = "var(--danger)";
        }
    }

    // --- WRAP UP & STORAGE ---
    function saveReflection() {
        const data = {
            r3: document.getElementById('ref3').value,
            r2: document.getElementById('ref2').value,
            r1: document.getElementById('ref1').value,
            timestamp: new Date().toISOString()
        };
        localStorage.setItem('ict_w2_reflection', JSON.stringify(data));
        
        document.getElementById('badgeArea').style.display = 'block';
        document.getElementById('badgeArea').scrollIntoView({behavior: 'smooth'});
        
        // Celebration Animation
        confettiEffect();
    }

    function saveProgress() {
        localStorage.setItem('ict_w2_progress', currentSection);
    }

    function loadProgress() {
        const saved = localStorage.getItem('ict_w2_progress');
        if(saved) {
            // Optional: Restore to last section. 
            // For now, we start fresh or at section 1 to ensure flow.
        }
        const reflection = JSON.parse(localStorage.getItem('ict_w2_reflection'));
        if(reflection) {
            document.getElementById('ref3').value = reflection.r3;
            document.getElementById('ref2').value = reflection.r2;
            document.getElementById('ref1').value = reflection.r1;
        }
    }

    // --- VOCABULARY ---
    function renderVocab() {
        const grid = document.getElementById('vocabGrid');
        grid.innerHTML = '';
        vocabList.forEach(v => {
            const item = document.createElement('div');
            item.className = 'vocab-item';
            item.innerHTML = `
                <h4>${v.term} <span class="speaker-icon" onclick="speak('${v.term}')">üîä</span></h4>
                <p style="font-size:0.9rem; margin-top:0.5rem;">${v.def}</p>
            `;
            grid.appendChild(item);
        });
    }

    function filterVocab() {
        const term = document.getElementById('vocabSearch').value.toLowerCase();
        const items = document.querySelectorAll('.vocab-item');
        items.forEach(item => {
            const text = item.innerText.toLowerCase();
            item.style.display = text.includes(term) ? 'block' : 'none';
        });
    }

    function speak(text) {
        const ut = new SpeechSynthesisUtterance(text);
        window.speechSynthesis.speak(ut);
    }

    // --- THEME ---
    function toggleTheme() {
        const body = document.body;
        if(body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme');
        } else {
            body.setAttribute('data-theme', 'dark');
        }
    }

    // Simple Confetti for Badge
    function confettiEffect() {
        const colors = ['#2563eb', '#10b981', '#f59e0b', '#ef4444'];
        for(let i=0; i<50; i++) {
            const d = document.createElement('div');
            d.style.position = 'fixed';
            d.style.left = Math.random() * 100 + 'vw';
            d.style.top = '-10px';
            d.style.width = '10px';
            d.style.height = '10px';
            d.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
            d.style.transition = 'top 2s ease-in, transform 2s linear';
            d.style.zIndex = '9999';
            document.body.appendChild(d);
            
            setTimeout(() => {
                d.style.top = '100vh';
                d.style.transform = `rotate(${Math.random()*360}deg)`;
            }, 100);
            
            setTimeout(() => d.remove(), 2100);
        }
    }

</script>

</body>
</html>