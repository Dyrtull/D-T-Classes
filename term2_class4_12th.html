<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 4: Motors, Buzzers & Power</title>
    <style>
        :root {
            --primary: #00979d;
            --secondary: #005f63;
            --accent: #ffb400;
            --bg-light: #f8f9fa;
            --text-light: #2d3436;
            --bg-dark: #2d3436;
            --text-dark: #dfe6e9;
            --card-bg-light: #ffffff;
            --card-bg-dark: #353b48;
            --success: #00b894;
            --error: #d63031;
            --transition: all 0.3s ease;
        }

        /* Base Styles & Dark Mode */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: var(--transition);
        }

        body.dark-mode {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        body.dark-mode .card, body.dark-mode nav, body.dark-mode .modal-content, body.dark-mode section {
            background-color: var(--card-bg-dark);
            color: var(--text-dark);
        }

        body.dark-mode .nav-links a {
            color: var(--text-dark);
        }

        /* Navigation */
        nav {
            background-color: var(--card-bg-light);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-title {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-light);
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .progress-container {
            width: 150px;
            height: 10px;
            background: #dfe6e9;
            border-radius: 5px;
            overflow: hidden;
            margin-right: 15px;
            display: none; /* Hidden on very small screens */
        }
        
        @media (min-width: 600px) {
            .progress-container { display: block; }
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.5s ease;
        }

        .mode-toggle {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-light);
        }

        body.dark-mode .mode-toggle {
            color: var(--accent);
        }

        /* Container & Layout */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        section {
            margin-bottom: 3rem;
            padding: 2rem;
            background: var(--card-bg-light);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease, background-color 0.3s;
        }

        section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        h1, h2, h3 {
            color: var(--primary);
        }

        /* Buttons */
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-block;
            margin-top: 1rem;
        }

        .btn:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        body.dark-mode .btn-outline {
            color: var(--accent);
            border-color: var(--accent);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }
        
        body.dark-mode .btn-outline:hover {
            background-color: var(--accent);
            color: #333;
        }

        .next-btn {
            display: block;
            width: 100%;
            text-align: center;
            margin-top: 2rem;
            background: var(--secondary);
        }

        /* Opening Activity - Simulation */
        .simulation-container {
            border: 2px dashed #bdc3c7;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            background: #f1f2f6;
            margin-top: 1rem;
        }
        
        body.dark-mode .simulation-container {
            background: #2c3e50;
            border-color: #34495e;
        }

        .circuit-board {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 200px;
            position: relative;
        }

        .component {
            width: 80px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .component:hover {
            transform: scale(1.05);
        }

        .component svg {
            width: 60px;
            height: 60px;
            filter: drop-shadow(0 4px 2px rgba(0,0,0,0.1));
        }
        
        .component-label {
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 5px;
            color: #333;
        }
        
        body.dark-mode .component-label {
            color: #eee;
        }

        .wire {
            position: absolute;
            height: 6px;
            background: #bdc3c7;
            top: 40%;
            left: 20%;
            width: 60%;
            z-index: 1;
            transition: background 0.5s;
            display: none;
        }

        .wire.connected {
            display: block;
            background: #e74c3c; /* Red for power */
        }
        
        .wire.safe {
            display: block;
            background: #2ecc71; /* Green for safe */
        }

        .status-display {
            margin-top: 1rem;
            font-weight: bold;
            min-height: 1.5rem;
        }

        /* Learning Objectives */
        .objectives-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .obj-card {
            background: rgba(0, 151, 157, 0.1);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        body.dark-mode .obj-card {
            background: rgba(0, 151, 157, 0.2);
        }

        /* Concept Cards & Accordions */
        .concept-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
            background: var(--card-bg-light);
        }
        
        body.dark-mode .concept-card {
            background: var(--card-bg-dark);
            border-color: #555;
        }

        .concept-header {
            padding: 1rem;
            background: rgba(0,0,0,0.03);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }
        
        body.dark-mode .concept-header {
            background: rgba(255,255,255,0.05);
        }

        .concept-body {
            padding: 0 1rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s;
        }

        .concept-body.open {
            padding: 1rem;
            max-height: 1000px;
        }

        .diagram-box {
            background: #fff;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin: 1rem 0;
            border: 1px solid #eee;
        }
        
        body.dark-mode .diagram-box {
            background: #2c3e50;
            border-color: #34495e;
        }

        /* Build Guide Styles (NEW) */
        .build-container {
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            background: rgba(0, 151, 157, 0.05);
        }

        .step-display {
            display: none;
            animation: fadeIn 0.4s;
        }
        .step-display.active {
            display: block;
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .step-number {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: var(--secondary);
            font-weight: bold;
        }

        .step-instruction {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .step-check {
            background: white;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #ccc;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        body.dark-mode .step-check {
            background: #3e4856;
            border-color: #555;
        }

        .step-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* Driver Content Styles */
        .driver-content {
            display: none;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .driver-content.active {
            display: block;
            animation: fadeIn 0.4s;
        }

        body.dark-mode .driver-content {
            background: #353b48;
            border-color: #555;
        }

        .driver-img {
            max-width: 100%;
            height: auto;
            max-height: 300px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-bottom: 1rem;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .pin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .pin-table th, .pin-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        body.dark-mode .pin-table th, body.dark-mode .pin-table td {
            border-color: #555;
        }

        .pin-table th {
            background-color: rgba(0, 151, 157, 0.1);
        }
        
        /* Code Block Styling */
        .code-block {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin-top: 1rem;
            text-align: left;
            border-left: 4px solid var(--accent);
        }
        
        .code-comment { color: #6a9955; }
        .code-keyword { color: #569cd6; }
        .code-function { color: #dcdcaa; }

        /* Practice & CCQs */
        .question-block {
            background: rgba(0,0,0,0.03);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--accent);
        }
        
        body.dark-mode .question-block {
            background: rgba(255,255,255,0.05);
        }

        .ccq-badge {
            background: var(--accent);
            color: #333;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .options-grid {
            display: grid;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .option-btn {
            background: white;
            border: 1px solid #ccc;
            padding: 0.8rem;
            text-align: left;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            color: #333;
            font-size: 1rem;
        }

        .option-btn:hover {
            background: #f0f0f0;
        }

        .option-btn.correct {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .option-btn.incorrect {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .feedback {
            margin-top: 10px;
            font-style: italic;
            display: none;
            padding: 0.5rem;
            border-radius: 4px;
        }

        /* Vocabulary */
        .vocab-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .vocab-card {
            background: var(--card-bg-light);
            border: 1px solid #ddd;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        body.dark-mode .vocab-card {
            background: #3e4856;
            border-color: #555;
        }

        .vocab-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .search-bar {
            width: 100%;
            padding: 0.8rem;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-bottom: 1rem;
            font-size: 1rem;
            box-sizing: border-box;
        }

        /* Wrap Up */
        .reflection-form textarea {
            width: 100%;
            padding: 0.8rem;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-bottom: 1rem;
            min-height: 80px;
            font-family: inherit;
            box-sizing: border-box;
        }
        
        .reflection-form input {
             margin-right: 10px;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake {
            animation: shake 0.5s;
            animation-iteration-count: infinite;
        }
        
        /* Tabs */
        .tabs {
            border-bottom: 1px solid #ddd;
            margin-bottom: 1rem;
        }
        
        .active-tab {
            background-color: var(--primary) !important;
            color: white !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                padding: 1rem;
            }
            .nav-links {
                margin-top: 1rem;
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }
            .circuit-board {
                flex-direction: column;
                height: auto;
                gap: 2rem;
                padding: 1rem 0;
            }
            .wire {
                display: none !important; /* Too complex for vertical mobile */
            }
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav>
    <div class="nav-title">‚ö° Week 4: Motors & Power</div>
    <div style="display: flex; align-items: center;">
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="nav-links">
            <a onclick="scrollToSection('opening')">Start</a>
            <a onclick="scrollToSection('concepts')">Concepts</a>
            <a onclick="scrollToSection('practice')">Practice</a>
            <a onclick="scrollToSection('wrapup')">Wrap-Up</a>
        </div>
        <button class="mode-toggle" onclick="toggleTheme()" style="margin-left: 1rem;" aria-label="Toggle Dark Mode">üåì</button>
    </div>
</nav>

<div class="container">

    <!-- 1. Opening Activity -->
    <section id="opening" class="visible">
        <h2>üîå The Power Problem: Mystery Reveal</h2>
        <p>Let's start with an experiment. You have an Arduino and a High-Power Motor. What happens if we connect them directly?</p>
        
        <div class="objectives-grid" style="margin-bottom: 2rem;">
            <div class="obj-card">
                <strong>Challenge:</strong> Try to connect the motor to verify if the Arduino Pin can power it safely.
            </div>
        </div>

        <div class="simulation-container">
            <div class="circuit-board">
                <div class="component">
                    <!-- SVG for Arduino -->
                    <svg viewBox="0 0 100 100">
                        <rect x="10" y="10" width="80" height="80" fill="#00979d" rx="5"/>
                        <circle cx="20" cy="20" r="4" fill="#fff"/>
                        <circle cx="20" cy="80" r="4" fill="#fff"/>
                        <circle cx="80" cy="20" r="4" fill="#fff"/>
                        <circle cx="80" cy="80" r="4" fill="#fff"/>
                        <text x="50" y="55" font-size="14" fill="white" text-anchor="middle" font-weight="bold">UNO</text>
                    </svg>
                    <div class="component-label">Pin 13 (40mA)</div>
                </div>
                
                <div class="wire" id="simWire"></div>
                
                <div class="component" id="transistorComp" style="display:none;">
                    <svg viewBox="0 0 100 100">
                        <path d="M25 30 Q50 10 75 30 L75 80 L25 80 Z" fill="#333" />
                        <rect x="30" y="80" width="8" height="15" fill="#95a5a6" />
                        <rect x="46" y="80" width="8" height="15" fill="#95a5a6" />
                        <rect x="62" y="80" width="8" height="15" fill="#95a5a6" />
                        <text x="50" y="60" fill="white" font-size="10" text-anchor="middle">2N2222</text>
                    </svg>
                    <div class="component-label">Transistor</div>
                </div>

                <div class="component">
                    <!-- SVG for Motor -->
                    <svg viewBox="0 0 100 100" id="motorSvg">
                        <circle cx="50" cy="50" r="35" fill="#95a5a6" stroke="#333" stroke-width="3"/>
                        <rect x="45" y="15" width="10" height="70" fill="#333" rx="2"/>
                        <path d="M50 15 L50 5" stroke="#e74c3c" stroke-width="3"/>
                        <path d="M50 85 L50 95" stroke="#333" stroke-width="3"/>
                    </svg>
                    <div class="component-label">Motor (100mA+)</div>
                </div>
            </div>
            
            <div class="status-display" id="simStatus">Waiting for connection...</div>
            
            <div id="simControls" style="margin-top: 1rem;">
                <button class="btn" onclick="runSimulation('direct')">Connect Directly</button>
                <button class="btn btn-outline" onclick="runSimulation('transistor')" id="btnTransistor" style="display:none;">Use Transistor Solution</button>
            </div>
        </div>

        <div id="openingReflection" style="display:none; margin-top: 2rem; background: rgba(0, 151, 157, 0.1); padding: 1.5rem; border-radius: 8px;">
            <h3>ü§î Quick Prediction</h3>
            <p>Why do you think the direct connection failed? (Don't worry if you don't know yet!)</p>
            <textarea id="openingInput" class="search-bar" placeholder="Type your guess here..."></textarea>
            <button class="btn" onclick="saveOpening()">Save Prediction & Continue</button>
        </div>
    </section>

    <!-- 2. Learning Objectives -->
    <section id="objectives">
        <h2>üéØ Learning Objectives</h2>
        <div class="objectives-grid">
            <div class="obj-card">
                <h3>Cognitive</h3>
                <p>By the end of this class, I will be able to:</p>
                <ul>
                    <li>Explain why Arduino pins cannot directly power motors (Current limits).</li>
                    <li>Use a <strong>Transistor</strong> as an electronic switch.</li>
                    <li>Wire a <strong>Diode</strong> to protect circuits from inductive spikes.</li>
                </ul>
            </div>
            <div class="obj-card">
                <h3>Social-Emotional</h3>
                <ul>
                    <li>Practice <strong>safety</strong> when handling components.</li>
                    <li>Develop <strong>resilience</strong> through troubleshooting circuit failures.</li>
                </ul>
            </div>
            <div class="obj-card">
                <h3>Success Criteria</h3>
                <ul>
                    <li>"I can build a circuit where a small signal controls a large power source."</li>
                    <li>"I can generate specific musical tones using code."</li>
                </ul>
            </div>
        </div>
        <button class="btn next-btn" onclick="scrollToSection('concepts')">Start Learning</button>
    </section>

    <!-- 3. Concept Exploration -->
    <section id="concepts">
        <h2>üìö Concept Exploration</h2>
        
        <!-- Concept 1: The Problem -->
        <div class="concept-card">
            <div class="concept-header" onclick="toggleAccordion(this)">
                1. The Current Problem: Straw vs. Hose
                <span style="font-size: 1.2rem;">‚ñº</span>
            </div>
            <div class="concept-body">
                <p>Think of electricity like water. The Arduino Pin is like a drinking straw‚Äîit can only handle a small amount of flow (Current). A Motor is like a garden hose‚Äîit needs a HUGE amount of flow.</p>
                <div class="diagram-box">
                    <p><strong>Arduino Pin Limit:</strong> 40mA (Milliamps)</p>
                    <p><strong>Motor Requirement:</strong> 100mA - 300mA</p>
                    <p style="color: var(--error); font-weight: bold;">Result: If you connect them, the Arduino resets or the pin burns out!</p>
                </div>
            </div>
        </div>

        <!-- Concept 2: The Transistor -->
        <div class="concept-card">
            <div class="concept-header" onclick="toggleAccordion(this)">
                2. The Solution: NPN Transistor (2N2222)
                <span style="font-size: 1.2rem;">‚ñº</span>
            </div>
            <div class="concept-body">
                <p>A transistor acts like a digital switch or a relay. It uses a tiny signal from the Arduino to open a "gate" that lets a huge amount of power flow from a battery or the 5V rail to the motor.</p>
                
                <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 2rem; margin: 1rem 0;">
                    <div style="text-align: center;">
                        <svg width="100" height="100" viewBox="0 0 100 100">
                            <!-- Transistor Package -->
                            <path d="M20 30 Q50 10 80 30 L80 80 L20 80 Z" fill="#333" />
                            <rect x="25" y="80" width="10" height="20" fill="#95a5a6" />
                            <rect x="45" y="80" width="10" height="20" fill="#95a5a6" />
                            <rect x="65" y="80" width="10" height="20" fill="#95a5a6" />
                            <text x="30" y="115" font-size="12" fill="var(--text-light)">E</text>
                            <text x="50" y="115" font-size="12" fill="var(--text-light)">B</text>
                            <text x="70" y="115" font-size="12" fill="var(--text-light)">C</text>
                            <text x="50" y="60" fill="white" font-size="10" text-anchor="middle">2N2222</text>
                        </svg>
                        <p><strong>Physical View</strong><br><small>Flat side facing you</small></p>
                    </div>
                    <div>
                        <ul style="text-align: left;">
                            <li><strong>Collector (C):</strong> Connects to the Motor (Load).</li>
                            <li><strong>Base (B):</strong> Connects to Arduino Pin (Control) via Resistor.</li>
                            <li><strong>Emitter (E):</strong> Connects to Ground (GND).</li>
                        </ul>
                    </div>
                </div>
                
                <div class="question-block" style="margin-top: 1rem;">
                    <span class="ccq-badge">Quick Check</span>
                    <p>Does the Arduino <em>power</em> the motor in a transistor circuit?</p>
                    <div class="options-grid">
                        <button class="option-btn" onclick="checkQuick(this, false)">Yes, directly.</button>
                        <button class="option-btn" onclick="checkQuick(this, true)">No, it only <em>controls</em> it.</button>
                    </div>
                    <div class="feedback">Correct! The power comes from the 5V rail or battery; Arduino just flips the switch.</div>
                </div>
            </div>
        </div>

        <!-- Concept 3: The Diode -->
        <div class="concept-card">
            <div class="concept-header" onclick="toggleAccordion(this)">
                3. The Bodyguard: Flyback Diode
                <span style="font-size: 1.2rem;">‚ñº</span>
            </div>
            <div class="concept-body">
                <p>Motors work using magnets. When you turn off a motor, it keeps spinning for a moment, turning into a generator! This creates a backward surge of electricity (Voltage Spike) that can fry your Arduino.</p>
                <p>The <strong>Diode</strong> is a one-way valve. We place it across the motor pins to safely redirect this spike back into the motor coil.</p>
                <div class="diagram-box">
                    <strong>Rule:</strong> Stripe on the diode goes to Positive (+).
                </div>
            </div>
        </div>

        <!-- Concept 4: Buzzers -->
        <div class="concept-card">
            <div class="concept-header" onclick="toggleAccordion(this)">
                4. Making Sound: Piezo Buzzers
                <span style="font-size: 1.2rem;">‚ñº</span>
            </div>
            <div class="concept-body">
                <p>Piezo buzzers vibrate a crystal to make sound. Unlike motors, they use very little current, so they <strong>can</strong> connect directly to Arduino pins!</p>
                <p>We use the <code>tone(pin, frequency)</code> command.</p>
                <div style="background: #2d3436; color: #fab1a0; padding: 1rem; border-radius: 6px; font-family: monospace; overflow-x: auto;">
                    tone(8, 440); // Play A4 note (440Hz) on pin 8<br>
                    delay(1000);  // Wait 1 second<br>
                    noTone(8);    // Stop sound
                </div>
            </div>
        </div>

        <button class="btn next-btn" onclick="scrollToSection('examples')">See Applied Examples</button>
    </section>

    <!-- 5. Applied Examples -->
    <section id="examples">
        <h2>üõ†Ô∏è Applied Examples</h2>
        
        <div class="tabs" style="display: flex; gap: 1rem; margin-bottom: 1rem;">
            <button class="btn btn-outline active-tab" onclick="switchTab('ex1', this)">1. Motor Circuit</button>
            <button class="btn btn-outline" onclick="switchTab('ex2', this)">2. Musical Code</button>
        </div>

        <!-- Example 1 -->
        <div id="ex1" class="tab-content">
            <h3>Standard Motor Driver Circuit</h3>
            <p>This is the standard pattern you will use for fans, vibration motors, and pumps.</p>
            <ol>
                <li><strong>Base:</strong> Pin 9 -> 1k Resistor -> Transistor Middle Leg</li>
                <li><strong>Emitter:</strong> Transistor Left Leg -> GND</li>
                <li><strong>Collector:</strong> Transistor Right Leg -> Motor Wire (-)</li>
                <li><strong>Power:</strong> 5V -> Motor Wire (+)</li>
                <li><strong>Protection:</strong> Diode across Motor (Stripe to +)</li>
            </ol>
            <div class="diagram-box">
                <!-- SVG Schematic Representation -->
                <svg viewBox="0 0 300 150" style="max-width: 100%; height: auto;">
                    <line x1="20" y1="75" x2="80" y2="75" stroke="#333" stroke-width="2"/>
                    <rect x="40" y="65" width="20" height="20" fill="white" stroke="#333"/> <!-- Resistor -->
                    <text x="40" y="60" font-size="10" fill="#333">1kŒ©</text>
                    
                    <line x1="80" y1="50" x2="80" y2="100" stroke="#333" stroke-width="2"/> <!-- Base Bar -->
                    <line x1="80" y1="75" x2="100" y2="75" stroke="#333" stroke-width="2"/> <!-- Base connection -->
                    
                    <line x1="100" y1="50" x2="100" y2="20" stroke="#333" stroke-width="2"/> <!-- Collector Path -->
                    <line x1="100" y1="100" x2="100" y2="130" stroke="#333" stroke-width="2"/> <!-- Emitter Path -->
                    <polygon points="100,130 95,125 105,125" fill="#333"/> <!-- Arrow -->
                    
                    <text x="100" y="145" text-anchor="middle" fill="#333">GND</text>
                    
                    <rect x="90" y="20" width="20" height="30" fill="#bdc3c7" stroke="#333" /> <!-- Motor Load -->
                    <text x="120" y="35" font-size="10" fill="#333">Motor</text>
                    
                    <line x1="100" y1="20" x2="100" y2="5" stroke="#333" stroke-width="2"/>
                    <text x="100" y="15" text-anchor="middle" font-weight="bold" fill="#333">5V</text>
                    
                    <text x="10" y="70" font-size="10" fill="#333">Pin 9</text>
                </svg>
            </div>
        </div>

        <!-- Example 2 -->
        <div id="ex2" class="tab-content" style="display:none;">
            <h3><a></a> Music</h3>
            <a href="buzzer.html" target="_blank" rel="noopener noreferrer">Official Arduino Tone Tutorial</a>
            <p>Try different frequencies to make different notes. Click the button to "hear" the simulation logic.</p>
            <div style="background: #2d3436; color: #fff; padding: 1rem; border-radius: 6px; overflow-x: auto;">
                <pre style="margin:0;">
void loop() {
  tone(8, 262); // C4
  delay(500);
  tone(8, 294); // D4
  delay(500);
  tone(8, 330); // E4
  delay(500);
  noTone(8);
}
                </pre>
            </div>
            <button class="btn" onclick="playVirtualTone()">‚ñ∂Ô∏è Play Simulation</button>
            <p id="toneStatus" style="margin-top:0.5rem; color: var(--success); min-height: 20px; font-weight: bold;"></p>
        </div>

        <button class="btn next-btn" onclick="scrollToSection('practice')">Go to Practice</button>
    </section>

    <!-- 6 & 7. Practice & Concept Checking -->
    <section id="practice">
        <h2>üß† Practice: Build & Check</h2>
        <p>This section is divided into two parts: Building the circuit (Guided Practice) and Checking your concepts.</p>

        <!-- Activity 1: Build the Motor Circuit -->
        <div class="build-container">
            <h3>üë∑ Activity 1: Build the Motor Circuit</h3>
            
            <!-- Step 1 -->
            <div id="step1" class="step-display active">
                <div class="step-header">
                    <div class="step-number">Step 1 of 6</div>
                    <div class="step-title">Position the Transistor</div>
                </div>
                <div class="step-instruction">
                    Find your <strong>2N2222 Transistor</strong> (the small black component with 3 legs).
                </div>
                <div class="diagram-box">
                    <svg width="100" height="80" viewBox="0 0 100 80">
                        <path d="M30 10 Q50 0 70 10 L70 50 L30 50 Z" fill="#333" />
                        <text x="50" y="35" fill="white" font-size="8" text-anchor="middle">2N2222</text>
                        <text x="50" y="70" fill="#333" font-size="10" text-anchor="middle">Flat side facing LEFT</text>
                    </svg>
                </div>
                <label class="step-check">
                    <input type="checkbox" onchange="enableNext(this)"> I have identified the flat side.
                </label>
                <div class="step-nav">
                    <button class="btn btn-outline" disabled>Previous</button>
                    <button class="btn" onclick="nextStep(1)" disabled>Next Step</button>
                </div>
            </div>

            <!-- Step 2 -->
            <div id="step2" class="step-display">
                <div class="step-header">
                    <div class="step-number">Step 2 of 6</div>
                    <div class="step-title">Place on Breadboard</div>
                </div>
                <div class="step-instruction">
                    Insert the transistor into the breadboard so it straddles the middle gap.
                </div>
                <label class="step-check">
                    <input type="checkbox" onchange="enableNext(this)"> Legs are in different rows.
                </label>
                <label class="step-check">
                    <input type="checkbox" onchange="enableNext(this)"> Flat side is facing LEFT.
                </label>
                <div class="step-nav">
                    <button class="btn btn-outline" onclick="prevStep(2)">Previous</button>
                    <button class="btn" onclick="nextStep(2)" disabled>Next Step</button>
                </div>
            </div>

            <!-- Step 3 -->
            <div id="step3" class="step-display">
                <div class="step-header">
                    <div class="step-number">Step 3 of 6</div>
                    <div class="step-title">Connect Base (Control)</div>
                </div>
                <div class="step-instruction">
                    Connect <strong>Arduino Pin 9</strong> to the <strong>Middle Leg</strong> (Base) using a 1kŒ© Resistor.
                </div>
                <div class="diagram-box">
                    Pin 9 ‚ûú Resistor ‚ûú Middle Leg
                </div>
                <label class="step-check">
                    <input type="checkbox" onchange="enableNext(this)"> Resistor connects Pin 9 to the center leg.
                </label>
                <div class="step-nav">
                    <button class="btn btn-outline" onclick="prevStep(3)">Previous</button>
                    <button class="btn" onclick="nextStep(3)" disabled>Next Step</button>
                </div>
            </div>

            <!-- Step 4 -->
            <div id="step4" class="step-display">
                <div class="step-header">
                    <div class="step-number">Step 4 of 6</div>
                    <div class="step-title">Connect Emitter (Ground)</div>
                </div>
                <div class="step-instruction">
                    Connect the <strong>Left Leg</strong> (Emitter) directly to <strong>GND</strong>.
                </div>
                <label class="step-check">
                    <input type="checkbox" onchange="enableNext(this)"> Left leg is connected to Ground rail.
                </label>
                <div class="step-nav">
                    <button class="btn btn-outline" onclick="prevStep(4)">Previous</button>
                    <button class="btn" onclick="nextStep(4)" disabled>Next Step</button>
                </div>
            </div>

            <!-- Step 5 -->
            <div id="step5" class="step-display">
                <div class="step-header">
                    <div class="step-number">Step 5 of 6</div>
                    <div class="step-title">Connect Motor</div>
                </div>
                <div class="step-instruction">
                    Connect the Motor wires:
                    <ul>
                        <li><strong>Red Wire (+)</strong> ‚ûú 5V Rail</li>
                        <li><strong>Black Wire (-)</strong> ‚ûú Transistor Right Leg (Collector)</li>
                    </ul>
                </div>
                <label class="step-check">
                    <input type="checkbox" onchange="enableNext(this)"> Motor is connected to 5V and Collector.
                </label>
                <div class="step-nav">
                    <button class="btn btn-outline" onclick="prevStep(5)">Previous</button>
                    <button class="btn" onclick="nextStep(5)" disabled>Next Step</button>
                </div>
            </div>

            <!-- Step 6 -->
            <div id="step6" class="step-display">
                <div class="step-header">
                    <div class="step-number">Step 6 of 6</div>
                    <div class="step-title">Add Diode Protection</div>
                </div>
                <div class="step-instruction" style="color: var(--error); font-weight: bold;">
                    CRITICAL SAFETY STEP!
                </div>
                <div class="step-instruction">
                    Place the diode ACROSS the motor connection points.
                    <br>
                    <strong>Stripe (Cathode)</strong> ‚ûú 5V / Red Wire side.
                </div>
                <label class="step-check">
                    <input type="checkbox" onchange="enableNext(this)"> Stripe is facing the positive (5V) side.
                </label>
                <div class="step-nav">
                    <button class="btn btn-outline" onclick="prevStep(6)">Previous</button>
                    <button class="btn" onclick="nextStep(6)" disabled>Finish Build</button>
                </div>
            </div>
            
            <div id="step-complete" class="step-display" style="text-align: center;">
                 <h3 style="color: var(--success);">‚úÖ Circuit Built!</h3>
                 <p>You may now upload the test code to verify it works.</p>
                 <div class="code-block">
<span class="code-keyword">int</span> motorPin = 9;<br><br>
<span class="code-keyword">void</span> <span class="code-function">setup</span>() {<br>
&nbsp;&nbsp;<span class="code-function">pinMode</span>(motorPin, OUTPUT);<br>
}<br><br>
<span class="code-keyword">void</span> <span class="code-function">loop</span>() {<br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(motorPin, HIGH); <span class="code-comment">// ON</span><br>
&nbsp;&nbsp;<span class="code-function">delay</span>(1000);<br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(motorPin, LOW); <span class="code-comment">// OFF</span><br>
&nbsp;&nbsp;<span class="code-function">delay</span>(1000);<br>
}
                 </div>
                 <button class="btn" style="margin-top: 1rem;" onclick="document.getElementById('quiz-container').scrollIntoView({behavior: 'smooth'})">Proceed to Concept Check</button>
            </div>
        </div>

        <!-- NEW Activity 2: Advanced Motor Drivers -->
        <div class="build-container" style="margin-top: 2rem; border-color: var(--accent);">
            <h3>üöÄ Activity 2: Advanced - Motor Drivers</h3>
            <p>If you have a Motor Driver module, select it below to see how to wire it. These allow you to control <strong>speed</strong> and <strong>direction</strong>!</p>
            
            <div class="tabs" style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                <button class="btn btn-outline active-tab" onclick="switchDriver('l298n', this)">L298N</button>
                <button class="btn btn-outline" onclick="switchDriver('tb6612', this)">TB6612FNG</button>
                <button class="btn btn-outline" onclick="switchDriver('drv8833', this)">DRV8833</button>
            </div>

            <!-- L298N Content -->
            <div id="l298n" class="driver-content active">
                <h4 style="margin-top:0;">L298N Motor Driver</h4>
                <img src="https://www.prometec.net/wp-content/uploads/2016/11/Conexiones-L298N.png" alt="L298N" class="driver-img">
                <p><strong>Use for:</strong> Larger motors (up to 2A). It is big but easy to wire.</p>
                
                <table class="pin-table">
                    <tr>
                        <th>Driver Pin</th>
                        <th>Connect To</th>
                        <th>Purpose</th>
                    </tr>
                    <tr><td>IN1</td><td>Arduino Pin 9</td><td>Direction Control A</td></tr>
                    <tr><td>IN2</td><td>Arduino Pin 8</td><td>Direction Control B</td></tr>
                    <tr><td>ENA</td><td>Arduino Pin 10 (PWM)</td><td>Speed Control</td></tr>
                    <tr><td>OUT1 / OUT2</td><td>Motor Wires</td><td>Power to Motor</td></tr>
                    <tr><td>12V</td><td>Battery (+)</td><td>Main Power Input</td></tr>
                    <tr><td>GND</td><td>Battery (-) AND Arduino GND</td><td>Common Ground</td></tr>
                </table>
                
                <div class="code-block">
<span class="code-comment">// L298N Control</span><br>
<span class="code-keyword">int</span> enA = 10; <span class="code-comment">// Speed</span><br>
<span class="code-keyword">int</span> in1 = 9;  <span class="code-comment">// Direction 1</span><br>
<span class="code-keyword">int</span> in2 = 8;  <span class="code-comment">// Direction 2</span><br><br>
<span class="code-keyword">void</span> <span class="code-function">setup</span>() {<br>
&nbsp;&nbsp;<span class="code-function">pinMode</span>(enA, OUTPUT);<br>
&nbsp;&nbsp;<span class="code-function">pinMode</span>(in1, OUTPUT);<br>
&nbsp;&nbsp;<span class="code-function">pinMode</span>(in2, OUTPUT);<br>
}<br><br>
<span class="code-keyword">void</span> <span class="code-function">loop</span>() {<br>
&nbsp;&nbsp;<span class="code-comment">// Move Forward</span><br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in1, HIGH);<br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in2, LOW);<br>
&nbsp;&nbsp;<span class="code-function">analogWrite</span>(enA, 200); <span class="code-comment">// Speed 0-255</span><br>
&nbsp;&nbsp;<span class="code-function">delay</span>(2000);<br><br>
&nbsp;&nbsp;<span class="code-comment">// Stop</span><br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in1, LOW);<br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in2, LOW);<br>
&nbsp;&nbsp;<span class="code-function">delay</span>(1000);<br><br>
&nbsp;&nbsp;<span class="code-comment">// Move Backward</span><br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in1, LOW);<br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in2, HIGH);<br>
&nbsp;&nbsp;<span class="code-function">analogWrite</span>(enA, 200);<br>
&nbsp;&nbsp;<span class="code-function">delay</span>(2000);<br>
}
                </div>
            </div>

            <!-- TB6612FNG Content -->
            <div id="tb6612" class="driver-content">
                <h4 style="margin-top:0;">TB6612FNG Driver</h4>
                <img src="https://m.media-amazon.com/images/I/51DOuaX+fXL.jpg" alt="TB6612FNG" class="driver-img">
                <p><strong>Use for:</strong> High efficiency, small projects. <strong>Note:</strong> STBY must be High to work.</p>
                
                <table class="pin-table">
                    <tr>
                        <th>Driver Pin</th>
                        <th>Connect To</th>
                        <th>Purpose</th>
                    </tr>
                    <tr><td>PWMA</td><td>Arduino Pin 5 (PWM)</td><td>Speed Control</td></tr>
                    <tr><td>AIN1</td><td>Arduino Pin 4</td><td>Direction Control A</td></tr>
                    <tr><td>AIN2</td><td>Arduino Pin 3</td><td>Direction Control B</td></tr>
                    <tr><td>STBY</td><td>Arduino 5V</td><td>Standby (Must be ON/High)</td></tr>
                    <tr><td>VM</td><td>Battery (+)</td><td>Motor Power</td></tr>
                    <tr><td>VCC</td><td>Arduino 5V</td><td>Logic Power</td></tr>
                    <tr><td>GND</td><td>GND</td><td>Ground</td></tr>
                </table>

                <div class="code-block">
<span class="code-comment">// TB6612FNG Control</span><br>
<span class="code-keyword">int</span> PWMA = 5; <span class="code-comment">// Speed</span><br>
<span class="code-keyword">int</span> AIN1 = 4; <span class="code-comment">// Direction 1</span><br>
<span class="code-keyword">int</span> AIN2 = 3; <span class="code-comment">// Direction 2</span><br>
<span class="code-comment">// Note: STBY pin connected directly to 5V</span><br><br>
<span class="code-keyword">void</span> <span class="code-function">setup</span>() {<br>
&nbsp;&nbsp;<span class="code-function">pinMode</span>(PWMA, OUTPUT);<br>
&nbsp;&nbsp;<span class="code-function">pinMode</span>(AIN1, OUTPUT);<br>
&nbsp;&nbsp;<span class="code-function">pinMode</span>(AIN2, OUTPUT);<br>
}<br><br>
<span class="code-keyword">void</span> <span class="code-function">loop</span>() {<br>
&nbsp;&nbsp;<span class="code-comment">// Forward</span><br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(AIN1, HIGH);<br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(AIN2, LOW);<br>
&nbsp;&nbsp;<span class="code-function">analogWrite</span>(PWMA, 150); <span class="code-comment">// Speed 0-255</span><br>
&nbsp;&nbsp;<span class="code-function">delay</span>(1000);<br><br>
&nbsp;&nbsp;<span class="code-comment">// Stop</span><br>
&nbsp;&nbsp;<span class="code-function">analogWrite</span>(PWMA, 0);<br>
&nbsp;&nbsp;<span class="code-function">delay</span>(1000);<br>
}
                </div>
            </div>

            <!-- DRV8833 Content -->
            <div id="drv8833" class="driver-content">
                <h4 style="margin-top:0;">DRV8833 Driver</h4>
                <img src="https://m.media-amazon.com/images/I/410r7mjF8US.jpg" alt="DRV8833" class="driver-img">
                <p><strong>Use for:</strong> Low voltage motors. Handles sleep mode automatically.</p>
                
                <table class="pin-table">
                    <tr>
                        <th>Driver Pin</th>
                        <th>Connect To</th>
                        <th>Purpose</th>
                    </tr>
                    <tr><td>IN1</td><td>Arduino Pin 5</td><td>Direction/Speed A</td></tr>
                    <tr><td>IN2</td><td>Arduino Pin 6</td><td>Direction/Speed B</td></tr>
                    <tr><td>OUT1 / OUT2</td><td>Motor Wires</td><td>Output to Motor</td></tr>
                    <tr><td>Vcc</td><td>Battery (+)</td><td>Motor Power (2.7V - 10V)</td></tr>
                    <tr><td>GND</td><td>GND</td><td>Ground</td></tr>
                </table>

                <div class="code-block">
<span class="code-comment">// DRV8833 Control</span><br>
<span class="code-keyword">int</span> in1 = 5; <span class="code-comment">// Input 1</span><br>
<span class="code-keyword">int</span> in2 = 6; <span class="code-comment">// Input 2</span><br><br>
<span class="code-keyword">void</span> <span class="code-function">setup</span>() {<br>
&nbsp;&nbsp;<span class="code-function">pinMode</span>(in1, OUTPUT);<br>
&nbsp;&nbsp;<span class="code-function">pinMode</span>(in2, OUTPUT);<br>
}<br><br>
<span class="code-keyword">void</span> <span class="code-function">loop</span>() {<br>
&nbsp;&nbsp;<span class="code-comment">// Forward</span><br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in1, HIGH);<br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in2, LOW);<br>
&nbsp;&nbsp;<span class="code-function">delay</span>(1000);<br><br>
&nbsp;&nbsp;<span class="code-comment">// Stop (Coast)</span><br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in1, LOW);<br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in2, LOW);<br>
&nbsp;&nbsp;<span class="code-function">delay</span>(1000);<br><br>
&nbsp;&nbsp;<span class="code-comment">// Reverse</span><br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in1, LOW);<br>
&nbsp;&nbsp;<span class="code-function">digitalWrite</span>(in2, HIGH);<br>
&nbsp;&nbsp;<span class="code-function">delay</span>(1000);<br>
}
                </div>
            </div>
        </div>

        <h3 style="margin-top: 3rem;">‚úÖ Concept Check</h3>
        <p>Now that you've built it, verify your understanding to unlock the Wrap-Up.</p>
        
        <div id="quiz-container">
            <!-- Question 1: Yes/No -->
            <div class="question-block" id="q1">
                <span class="ccq-badge">Concept Check: Yes/No</span>
                <h4>1. Can a process like powering a heavy motor happen safely directly from Pin 13?</h4>
                <div class="options-grid">
                    <button class="option-btn" onclick="checkAnswer(1, 'yes', 'incorrect', 'Incorrect. Pin 13 only gives 40mA. The motor needs 100mA+.')">Yes, it has 5 Volts.</button>
                    <button class="option-btn" onclick="checkAnswer(1, 'no', 'correct', 'Correct! The voltage is fine, but the CURRENT (Amps) is too weak.')">No, the current is too low.</button>
                </div>
                <div class="feedback" id="f1"></div>
            </div>

            <!-- Question 2: Wh- Question -->
            <div class="question-block" id="q2" style="display:none;">
                <span class="ccq-badge">Concept Check: Why?</span>
                <h4>2. Why does the diode need to be placed "backwards" (stripe to positive)?</h4>
                <div class="options-grid">
                    <button class="option-btn" onclick="checkAnswer(2, 'a', 'incorrect', 'No, that would block power to the motor entirely.')">To stop current from flowing to the motor.</button>
                    <button class="option-btn" onclick="checkAnswer(2, 'b', 'correct', 'Exactly. It only conducts when there is a reverse spike from the motor stopping.')">To block normal flow but catch the reverse spike.</button>
                    <button class="option-btn" onclick="checkAnswer(2, 'c', 'incorrect', 'No, the diode does not amplify anything.')">To make the motor spin faster.</button>
                </div>
                <div class="feedback" id="f2"></div>
            </div>

            <!-- Question 3: Negative Check -->
            <div class="question-block" id="q3" style="display:none;">
                <span class="ccq-badge">Concept Check: Negative</span>
                <h4>3. Would it be correct to say the Transistor generates the power for the motor?</h4>
                <div class="options-grid">
                    <button class="option-btn" onclick="checkAnswer(3, 'a', 'incorrect', 'Incorrect. Transistors do not generate power; they consume a tiny bit of it to work.')">Yes, it amplifies the power.</button>
                    <button class="option-btn" onclick="checkAnswer(3, 'b', 'correct', 'Correct! The transistor is just a gate/switch. The Battery/5V source provides the actual power.')">No, it just controls the flow from the source.</button>
                </div>
                <div class="feedback" id="f3"></div>
            </div>
            
            <!-- Question 4: Application -->
            <div class="question-block" id="q4" style="display:none;">
                <span class="ccq-badge">Concept Check: Application</span>
                <h4>4. If we changed the 1kŒ© Base resistor to a simple wire (0Œ©), what might happen?</h4>
                <div class="options-grid">
                    <button class="option-btn" onclick="checkAnswer(4, 'a', 'correct', 'Correct. Without the resistor, too much current flows from Pin 9 to the Transistor Base, damaging it.')">The transistor or Arduino pin might burn out.</button>
                    <button class="option-btn" onclick="checkAnswer(4, 'b', 'incorrect', 'No, the motor is on the Collector side, not the Base side.')">The motor would spin twice as fast.</button>
                </div>
                <div class="feedback" id="f4"></div>
            </div>

             <!-- Question 5: Comparison -->
            <div class="question-block" id="q5" style="display:none;">
                <span class="ccq-badge">Concept Check: Comparison</span>
                <h4>5. What is the difference between a Motor and a Piezo Buzzer?</h4>
                <div class="options-grid">
                    <button class="option-btn" onclick="checkAnswer(5, 'a', 'incorrect', 'Actually, motors use inductive coils, piezos use crystals.')">Motors use crystals, Buzzers use magnets.</button>
                    <button class="option-btn" onclick="checkAnswer(5, 'b', 'correct', 'Correct. Motors are high-current inductive loads (need transistor). Piezos are low-current capacitive loads (direct pin OK).')">Motors need high current (Transistor); Buzzers use low current (Direct Pin).</button>
                </div>
                <div class="feedback" id="f5"></div>
            </div>
        </div>
        
        <div id="quiz-complete" style="display:none; text-align: center;">
            <div style="font-size: 3rem;">üéâ</div>
            <h3>Great Job!</h3>
            <p>You have mastered the safety and control concepts.</p>
            <button class="btn" onclick="scrollToSection('wrapup')">Go to Wrap Up</button>
        </div>
    </section>

    <!-- 8 & 9. Synthesis & Wrap Up -->
    <section id="wrapup">
        <h2>üìù Wrap-Up & Reflection</h2>
        
        <div class="tabs" style="display: flex; gap: 1rem; margin-bottom: 1rem;">
             <button class="btn btn-outline active-tab" onclick="switchWrapTab('reflect', this)">Reflection</button>
             <button class="btn btn-outline" onclick="switchWrapTab('vocab', this)">Vocabulary</button>
        </div>

        <div id="reflect-tab">
            <h3>3-2-1 Reflection</h3>
            <div class="reflection-form">
                <label><strong>3</strong> Things you learned today:</label>
                <textarea id="ref3" placeholder="1. Transistors are switches..."></textarea>
                
                <label><strong>2</strong> Interesting facts:</label>
                <textarea id="ref2" placeholder="1. Motors act like generators when stopping..."></textarea>
                
                <label><strong>1</strong> Question you still have:</label>
                <textarea id="ref1" placeholder="How do I control the speed?"></textarea>
                
                <div class="obj-card" style="margin: 1rem 0;">
                    <h4>Objective Check:</h4>
                    <label style="display:block; margin: 5px 0; cursor: pointer;">
                        <input type="checkbox" id="check1"> I can explain why direct connection fails.
                    </label>
                    <label style="display:block; margin: 5px 0; cursor: pointer;">
                        <input type="checkbox" id="check2"> I can wire a transistor circuit safely.
                    </label>
                    <label style="display:block; margin: 5px 0; cursor: pointer;">
                        <input type="checkbox" id="check3"> I know what the diode protects.
                    </label>
                </div>
                
                <button class="btn" onclick="saveReflection()">Save & Finish Class</button>
            </div>
            
            <div id="final-message" style="display:none; margin-top: 2rem; text-align: center; background: #d4edda; padding: 2rem; border-radius: 8px;">
                <h2 style="color: #155724;">üéâ Class Complete!</h2>
                <p>You are ready for the Final Project next week!</p>
                <div style="background: white; padding: 1rem; border-radius: 8px; margin-top: 1rem; border: 2px dashed #155724;">
                    <strong>Next Week Preview:</strong><br>
                    You will pick your final project group:<br>
                    üíä Pill Container | üå°Ô∏è Temperature Blanket | ü•´ Pantry Tracker | ‚òÄÔ∏è Sun Bracelet
                </div>
            </div>
        </div>

        <!-- 11. Vocabulary Section -->
        <div id="vocab-tab" style="display:none;">
            <h3>üîë Key Terms</h3>
            <input type="text" class="search-bar" id="vocabSearch" onkeyup="filterVocab()" placeholder="Search terms (e.g., Diode)...">
            
            <div class="vocab-grid" id="vocabGrid">
                <!-- Populated by JS -->
            </div>
        </div>
    </section>

</div>

<script>
    // --- Data & State ---
    const vocabList = [
        { term: "Transistor (NPN)", def: "Electronic component that acts as a switch. Uses a small signal to control a large current." },
        { term: "Diode", def: "A component that allows current to flow in only one direction. Used for protection." },
        { term: "Inductive Load", def: "Devices like motors that use magnetic coils. They create voltage spikes when turned off." },
        { term: "Current (Amps)", def: "The flow of electricity. Arduino pins provide very little (40mA)." },
        { term: "Piezo Buzzer", def: "A sound component that vibrates a crystal. Can be powered directly by Arduino." },
        { term: "Frequency (Hz)", def: "The speed of vibration. Determines the pitch of the sound." },
        { term: "Base", def: "The transistor leg that receives the control signal." },
        { term: "Collector", def: "The transistor leg that connects to the motor (Load)." },
        { term: "Emitter", def: "The transistor leg that connects to Ground." }
    ];

    // --- Navigation & UI ---
    function scrollToSection(id) {
        document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    // Initialize Theme
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
    }

    // Scroll Observer for Sections
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                updateProgress();
            }
        });
    }, {  threshold: 0.1,  // Lower threshold
    rootMargin: '50px'  // Trigger earlier

    });

    document.querySelectorAll('section').forEach(sec => observer.observe(sec));

    function updateProgress() {
        const sections = document.querySelectorAll('section');
        let visibleCount = 0;
        sections.forEach(sec => {
            if (sec.getBoundingClientRect().top < window.innerHeight) visibleCount++;
        });
        const pct = (visibleCount / sections.length) * 100;
        document.getElementById('progressBar').style.width = pct + '%';
    }

    function toggleAccordion(header) {
        const body = header.nextElementSibling;
        const isOpen = body.classList.contains('open');
        
        // Close all others
        document.querySelectorAll('.concept-body').forEach(b => {
            b.classList.remove('open');
            b.previousElementSibling.querySelector('span').innerText = '‚ñº';
        });

        if (!isOpen) {
            body.classList.add('open');
            header.querySelector('span').innerText = '‚ñ≤';
        }
    }

    function switchTab(tabId, btn) {
        document.getElementById('ex1').style.display = 'none';
        document.getElementById('ex2').style.display = 'none';
        document.getElementById(tabId).style.display = 'block';
        
        // Reset buttons
        btn.parentElement.querySelectorAll('.btn-outline').forEach(b => b.classList.remove('active-tab'));
        btn.classList.add('active-tab');
    }
    
    function switchWrapTab(tabId, btn) {
        document.getElementById('reflect-tab').style.display = 'none';
        document.getElementById('vocab-tab').style.display = 'none';
        
        if(tabId === 'reflect') document.getElementById('reflect-tab').style.display = 'block';
        if(tabId === 'vocab') document.getElementById('vocab-tab').style.display = 'block';

        btn.parentElement.querySelectorAll('.btn-outline').forEach(b => b.classList.remove('active-tab'));
        btn.classList.add('active-tab');
    }

    // --- Driver Tab Switch ---
    function switchDriver(driverId, btn) {
        // Hide all
        document.querySelectorAll('.driver-content').forEach(d => d.classList.remove('active'));
        // Show target
        document.getElementById(driverId).classList.add('active');
        
        // Handle buttons
        btn.parentElement.querySelectorAll('.btn-outline').forEach(b => b.classList.remove('active-tab'));
        btn.classList.add('active-tab');
    }


    // --- Build Guide Logic ---
    function enableNext(checkbox) {
        const stepDiv = checkbox.closest('.step-display');
        const nextBtn = stepDiv.querySelector('.step-nav .btn:last-child');
        
        // Check all checkboxes in this step
        const allChecks = stepDiv.querySelectorAll('input[type="checkbox"]');
        const allChecked = Array.from(allChecks).every(c => c.checked);
        
        nextBtn.disabled = !allChecked;
    }

    function nextStep(current) {
        document.getElementById('step' + current).classList.remove('active');
        const nextId = current < 6 ? 'step' + (current + 1) : 'step-complete';
        document.getElementById(nextId).classList.add('active');
    }

    function prevStep(current) {
        document.getElementById('step' + current).classList.remove('active');
        document.getElementById('step' + (current - 1)).classList.add('active');
    }


    // --- Opening Simulation ---
    function runSimulation(type) {
        const status = document.getElementById('simStatus');
        const wire = document.getElementById('simWire');
        const motor = document.getElementById('motorSvg');
        
        if (type === 'direct') {
            wire.style.display = 'block';
            wire.classList.add('connected');
            status.innerText = "Powering up...";
            
            setTimeout(() => {
                status.innerText = "‚ö†Ô∏è FAIL! Motor draws 150mA. Arduino Pin max is 40mA. Resetting...";
                status.style.color = "var(--error)";
                motor.classList.add('shake');
                setTimeout(() => {
                    motor.classList.remove('shake');
                    document.getElementById('btnTransistor').style.display = 'inline-block';
                    document.getElementById('openingReflection').style.display = 'block';
                    scrollToSection('openingReflection');
                }, 2000);
            }, 1000);
        } else if (type === 'transistor') {
            wire.className = 'wire safe'; // Change visual to green
            document.getElementById('transistorComp').style.display = 'flex';
            status.innerText = "‚úÖ Success! Transistor handles the current. Motor spins safely.";
            status.style.color = "var(--success)";
            motor.classList.add('shake');
        }
    }

    function saveOpening() {
        const input = document.getElementById('openingInput').value;
        if(input.trim() === "") {
            alert("Please type a quick guess!");
            return;
        }
        localStorage.setItem('openingPrediction', input);
        alert("Prediction saved! Let's see if you're right.");
        scrollToSection('objectives');
    }

    // --- Interactive Concept Quick Check ---
    function checkQuick(btn, isCorrect) {
        const feedback = btn.parentElement.nextElementSibling;
        feedback.style.display = 'block';
        if (isCorrect) {
            btn.classList.add('correct');
        } else {
            btn.classList.add('incorrect');
        }
    }

    // --- Tone Simulation ---
    function playVirtualTone() {
        const status = document.getElementById('toneStatus');
        status.innerText = "üé∂ Playing: Do (262Hz)... Re (294Hz)... Mi (330Hz)...";
        setTimeout(() => status.innerText = "", 3000);
    }

    // --- Practice Quiz Logic ---
    let currentQ = 1;
    const totalQ = 5;

    function checkAnswer(qNum, answer, type, msg) {
        const feedbackEl = document.getElementById('f' + qNum);
        feedbackEl.innerText = msg;
        feedbackEl.style.display = 'block';
        
        // Visual updates
        const btns = document.getElementById('q' + qNum).querySelectorAll('.option-btn');
        btns.forEach(b => b.disabled = true);
        
        const clickedBtn = event.target;
        clickedBtn.classList.add(type); // 'correct' or 'incorrect'

        if (type === 'correct') {
            feedbackEl.style.color = "var(--success)";
            setTimeout(() => {
                if (qNum < totalQ) {
                    document.getElementById('q' + qNum).style.display = 'none';
                    document.getElementById('q' + (qNum + 1)).style.display = 'block';
                    currentQ++;
                } else {
                    document.getElementById('q' + qNum).style.display = 'none';
                    document.getElementById('quiz-complete').style.display = 'block';
                }
            }, 2500);
        } else {
            feedbackEl.style.color = "var(--error)";
            // Allow retry
            setTimeout(() => {
                 btns.forEach(b => b.disabled = false);
                 clickedBtn.classList.remove(type);
                 feedbackEl.style.display = 'none';
            }, 2000);
        }
    }

    // --- Wrap Up & Local Storage ---
    function saveReflection() {
        const data = {
            r3: document.getElementById('ref3').value,
            r2: document.getElementById('ref2').value,
            r1: document.getElementById('ref1').value,
            checks: [
                document.getElementById('check1').checked,
                document.getElementById('check2').checked,
                document.getElementById('check3').checked
            ]
        };
        
        if(!data.checks.every(c => c)) {
            alert("Please review the objectives checklist. Are you sure you can do all three?");
            return;
        }

        localStorage.setItem('week4_reflection', JSON.stringify(data));
        document.querySelector('.reflection-form').style.display = 'none';
        document.getElementById('final-message').style.display = 'block';
    }

    // --- Vocabulary ---
    function initVocab() {
        const grid = document.getElementById('vocabGrid');
        grid.innerHTML = '';
        vocabList.forEach(v => {
            const card = document.createElement('div');
            card.className = 'vocab-card';
            card.innerHTML = `<strong>${v.term}</strong><p>${v.def}</p>`;
            grid.appendChild(card);
        });
    }

    function filterVocab() {
        const term = document.getElementById('vocabSearch').value.toLowerCase();
        const cards = document.querySelectorAll('.vocab-card');
        cards.forEach(card => {
            const text = card.innerText.toLowerCase();
            card.style.display = text.includes(term) ? 'block' : 'none';
        });
    }

    initVocab();

</script>

</body>
</html>